<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rozkłady Pociągów PKP ICC (Nieoficjalne)</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        /* --- CSS Variables for Theming --- */
        :root {
            --primary-color: #005b96; /* Deep blue */
            --secondary-color: #003366; /* Darker blue */
            --accent-color: #00a1de; /* Lighter blue */
            --danger-color: #c62828; /* Red for end station */
            --success-color: #2e7d32; /* Green for start station */
            --warning-color: #ffc107; /* Yellow for warnings */
            --info-color: #1565c0; /* Blue for major stops */
            --authenticity-color: #6a1b9a; /* Purple for authenticity */
            --chat-bot-bg: var(--secondary-color);
            --chat-user-bg: var(--accent-color);
            --chat-text-color: #ffffff;

            --bg-color: #f8f9fa; /* Light background */
            --card-bg-color: #ffffff; /* Card background */
            --text-color: #333; /* Main text */
            --text-muted-color: #6c757d; /* Muted text */
            --border-color: #e0e0e0; /* Borders */
            --header-text-color: #ffffff;
            --table-header-bg: var(--secondary-color);
            --table-header-text: #ffffff;
            --link-color: var(--primary-color);
            --highlight-bg: #e3f2fd; /* Light blue highlight */
            --highlight-border: var(--info-color);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --input-bg-color: #ffffff;
            --input-border-color: #ced4da;
            --input-focus-border-color: var(--primary-color);
            --modal-overlay-bg: rgba(0, 0, 0, 0.6);
            --modal-bg: #ffffff;
            --modal-border: #ccc;

            --font-main: 'Roboto', sans-serif;
            --font-mono: 'Roboto Mono', monospace;

            --base-font-size: 16px; /* Base font size for scaling */
            --side-decoration-width: 50px; /* Increased width for side decorations */
        }

        html {
            font-size: var(--base-font-size);
            scroll-behavior: smooth;
            position: relative; /* Needed for pseudo-elements */
            overflow-x: hidden; /* Prevent horizontal scroll caused by pseudo-elements */
            box-sizing: border-box; /* Include padding/border in element's total width/height */
        }
        *, *::before, *::after {
             box-sizing: inherit; /* Inherit box-sizing from html */
        }


        body.dark-mode {
            --primary-color: #007bff; /* Brighter blue for dark mode */
            --secondary-color: #0056b3;
            --accent-color: #17a2b8;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8; /* Info blue for dark mode */
            --authenticity-color: #ab47bc; /* Lighter purple */
            --chat-bot-bg: var(--secondary-color);
            --chat-user-bg: var(--accent-color);
            --chat-text-color: #e0e0e0;


            --bg-color: #1a1a1a; /* Dark background */
            --card-bg-color: #2c2c2c; /* Dark card background */
            --text-color: #e0e0e0; /* Light text */
            --text-muted-color: #adb5bd; /* Muted light text */
            --border-color: #444; /* Darker borders */
            --header-text-color: #ffffff;
            --table-header-bg: #3a3a3a; /* Dark table header */
            --table-header-text: #e0e0e0;
            --link-color: var(--accent-color);
            --highlight-bg: #3a3a3a; /* Dark highlight */
            --highlight-border: var(--info-color);
            --shadow-color: rgba(255, 255, 255, 0.1);
            --input-bg-color: #3a3a3a;
            --input-border-color: #555;
            --input-focus-border-color: var(--accent-color);
            --modal-overlay-bg: rgba(0, 0, 0, 0.7);
            --modal-bg: #333;
            --modal-border: #555;
        }

        /* --- Side Decorations (Enhanced) --- */
        html::before,
        html::after {
            content: '';
            position: fixed;
            top: 0;
            bottom: 0;
            width: var(--side-decoration-width);
            z-index: -1; /* Behind everything */
            /* Slightly more visible gradient */
            background: linear-gradient(to bottom, rgba(0, 91, 150, 0.15), rgba(0, 51, 102, 0.20));
            pointer-events: none; /* Don't interfere with clicks */
            transition: background 0.3s ease, opacity 0.3s ease;
        }

        html::before {
            left: 0;
        }

        html::after {
            right: 0;
        }

        body.dark-mode html::before,
        body.dark-mode html::after {
             /* Adjusted dark mode gradient for better visibility */
            background: linear-gradient(to bottom, rgba(0, 123, 255, 0.18), rgba(0, 86, 179, 0.25));
        }

        /* --- General Styles --- */
        * {
            /* box-sizing: border-box; REMOVED - Inherited from html */
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
            padding: 20px;
            font-size: 1rem;
            /* Add padding to account for side decorations */
            padding-left: calc(var(--side-decoration-width) + 15px);
            padding-right: calc(var(--side-decoration-width) + 15px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            /* Container padding is now handled by body padding */
            padding: 0;
            position: relative; /* Ensure container content is above pseudo-elements if needed */
            z-index: 1;
        }

        /* ... (Rest of the general styles like h1, h2, h3, a remain the same) ... */
        h1, h2, h3 {
            margin-bottom: 0.8rem;
            color: var(--primary-color);
            font-weight: 700;
        }
        body.dark-mode h1, body.dark-mode h2, body.dark-mode h3 {
            color: var(--accent-color);
        }
        h1 { font-size: 2.2rem; }
        h2 { font-size: 1.8rem; }
        h3 { font-size: 1.3rem; }

        a {
            color: var(--link-color);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        a:hover {
            text-decoration: underline;
            color: var(--secondary-color);
        }
        body.dark-mode a:hover {
            color: var(--primary-color);
        }


        /* --- Header --- */
        /* ... (Header styles remain largely the same) ... */
        .main-header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: var(--header-text-color);
            padding: 20px 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px var(--shadow-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        /* ... (Header title, search, controls, time/date, etc. styles remain the same) ... */
        .header-title { flex: 1 1 auto; min-width: 250px; }
        .header-title h1 {
            margin: 0;
            font-weight: 700;
            color: var(--header-text-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
         .header-title h1 i { font-size: 0.9em; }
        .header-title p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .header-search {
            flex: 1 1 320px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .header-search input[type="search"] {
            width: 100%;
            padding: 10px 15px;
            font-size: 0.95rem;
            border: 1px solid var(--input-border-color);
            border-radius: 50px;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            outline: none;
        }
        .header-search input[type="search"]::placeholder {
            color: var(--text-muted-color);
        }
        .header-search input[type="search"]:focus {
            border-color: var(--input-focus-border-color);
            box-shadow: 0 0 0 3px rgba(var(--input-focus-border-color), 0.25);
        }
        .header-search button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--header-text-color);
            padding: 10px 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
            transition: background-color 0.2s ease;
            flex-shrink: 0;
        }
        .header-search button:hover {
             background: rgba(255, 255, 255, 0.35);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .time-date {
            text-align: right;
            font-size: 0.9rem;
            line-height: 1.3;
            padding: 5px 0;
        }
        #current-time { font-weight: 500; }

        .control-group {
            display: flex;
            gap: 8px;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
            position: relative; /* Needed for language dropdown */
        }
        body.dark-mode .control-group {
             background: rgba(0, 0, 0, 0.2);
        }

        .control-group button:not(.lang-option) { /* Exclude hidden lang options from general button styles */
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: var(--header-text-color);
            padding: 6px 10px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
         .control-group button:not(.lang-option):hover {
             background: rgba(255, 255, 255, 0.35);
         }
         .control-group button i { font-size: 1em; }

        /* --- Language Selector NEW Styles --- */
        .language-selector {
            padding: 0; /* Remove padding from group */
            background: none; /* Remove background from group */
        }
        #current-lang-display {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 5px 10px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            display: flex;
            align-items: center;
        }
        #current-lang-display:hover {
            background: rgba(255, 255, 255, 0.35);
        }
        #current-lang-display img {
            width: 20px;
            height: auto;
            border-radius: 3px;
            display: block; /* Prevents small gap below image */
        }

        .language-options {
            display: none; /* Hidden by default */
            position: absolute;
            top: 100%; /* Position below the current flag */
            right: 0; /* Align to the right of the control group */
            margin-top: 5px; /* Small gap */
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 15px var(--shadow-color);
            padding: 5px;
            z-index: 100; /* Ensure it's above other elements */
            /* display: flex; /* Replaced by JS/Hover */
            flex-direction: column;
            gap: 3px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }
        .language-selector:hover .language-options,
        .language-selector #current-lang-display:focus + .language-options, /* Show on focus */
        .language-options:focus-within /* Keep open if interacting with options */
        {
             display: flex; /* Show on hover/focus */
             opacity: 1;
             visibility: visible;
        }

        .lang-option { /* Individual language button inside dropdown */
            background: none;
            border: none;
            padding: 6px 10px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            text-align: left;
            font-size: 0.9rem;
            color: var(--text-color);
            transition: background-color 0.2s ease;
        }
        .lang-option img {
            width: 18px;
            height: auto;
            border-radius: 2px;
            flex-shrink: 0;
        }
        .lang-option:hover, .lang-option:focus {
            background-color: var(--highlight-bg);
            outline: none;
        }
        body.dark-mode .lang-option {
             color: var(--text-color);
        }
        body.dark-mode .lang-option:hover, body.dark-mode .lang-option:focus {
            background-color: var(--highlight-bg);
        }

         /* Font Size Control Specifics */
         .font-size-controls button {
             min-width: 30px;
             justify-content: center;
         }
         .font-size-controls button i.fa-text-height { font-size: 0.8em; }
         .font-size-controls button i.fa-undo { font-size: 0.8em; }


        /* --- Search Feedback --- */
        /* ... (Search feedback styles remain the same) ... */
        #search-feedback {
            padding: 12px 18px;
            margin: -15px 0 20px 0;
            border-radius: 6px;
            font-size: 0.95rem;
            text-align: center;
            display: none;
            border: 1px solid transparent;
            transition: all 0.3s ease;
        }
        #search-feedback.success {
            background-color: #d1e7dd;
            color: #0f5132;
            border-color: #badbcc;
        }
        #search-feedback.error {
            background-color: #f8d7da;
            color: #842029;
            border-color: #f5c2c7;
        }
        body.dark-mode #search-feedback.success {
             background-color: #0f5132;
             color: #badbcc;
             border-color: #2f6f4e;
        }
         body.dark-mode #search-feedback.error {
             background-color: #842029;
             color: #f5c2c7;
             border-color: #a33e47;
         }

        /* --- Disclaimers & Banners --- */
        /* ... (Disclaimer and banner styles remain the same) ... */
        .disclaimer-box, .authenticity-banner {
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            border-left-width: 5px;
            border-left-style: solid;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .disclaimer-box i, .authenticity-banner i { font-size: 1.3rem; margin-top: 3px; flex-shrink: 0; }

        .disclaimer-box {
            background-color: #fff3cd;
            border-left-color: var(--warning-color);
            color: #664d03;
        }
        .disclaimer-box i { color: var(--warning-color); }
        body.dark-mode .disclaimer-box {
            background-color: #332701;
            color: #ffecb3;
            border-left-color: var(--warning-color);
        }
        body.dark-mode .disclaimer-box i { color: var(--warning-color); }

        .authenticity-banner {
            background-color: #f3e5f5;
            border-left-color: var(--authenticity-color);
            color: #4a148c;
            margin-top: -5px;
            margin-bottom: 20px;
        }
        .authenticity-banner i { color: var(--authenticity-color); }
        body.dark-mode .authenticity-banner {
            background-color: #381f3f;
            color: #e1bee7;
            border-left-color: var(--authenticity-color);
        }
         body.dark-mode .authenticity-banner i { color: var(--authenticity-color); }

        .confirmation-banner {
             background-color: #e8f5e9;
             border-left: 4px solid var(--success-color);
             padding: 1rem;
             margin-bottom: 1.5rem;
             font-size: 0.9rem;
             display: flex;
             align-items: flex-start;
             gap: 0.8rem;
             border-radius: 4px;
             box-shadow: 0 2px 4px rgba(0,0,0,0.05);
             color: #145214;
        }
        .confirmation-banner i { color: var(--success-color); font-size: 1.2rem; margin-top: 3px;}
         body.dark-mode .confirmation-banner {
             background-color: #1b3d1b;
             color: #c8e6c9;
             border-left-color: var(--success-color);
         }
         body.dark-mode .confirmation-banner i { color: var(--success-color); }


        /* --- Train Selector --- */
        /* ... (Train selector styles remain the same) ... */
        .train-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .train-selector button {
            padding: 10px 18px;
            font-size: 0.95rem;
            font-weight: 500;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg-color);
            color: var(--text-color);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px var(--shadow-color);
        }
        .train-selector button:hover {
            background-color: var(--highlight-bg);
            border-color: var(--primary-color);
            box-shadow: 0 3px 6px var(--shadow-color);
            transform: translateY(-1px);
        }
        .train-selector button.active {
            background-color: var(--primary-color);
            color: var(--header-text-color);
            border-color: var(--primary-color);
            box-shadow: 0 4px 8px rgba(0, 91, 150, 0.3);
            transform: translateY(0);
        }
        .train-selector button i { opacity: 0.9; }
        .train-selector button.active i { opacity: 1; }

        body.dark-mode .train-selector button {
             border-color: var(--border-color);
             background-color: var(--card-bg-color);
             color: var(--text-color);
        }
        body.dark-mode .train-selector button:hover {
            background-color: #3a3a3a;
            border-color: var(--accent-color);
        }
        body.dark-mode .train-selector button.active {
            background-color: var(--accent-color);
            color: #1a1a1a;
            border-color: var(--accent-color);
             box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
        }

        /* --- Train Content Area --- */
        /* ... (Train content area styles remain the same) ... */
        .train-content {
            display: none;
            background-color: var(--card-bg-color);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 8px 25px var(--shadow-color);
            margin-bottom: 30px;
            transition: background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .train-content.active {
            display: block;
        }

        /* --- Specific Train Styles --- */
        /* ... (Train header, info section, speed chart styles remain the same) ... */
        .train-header {
             padding: 20px 25px;
             border-radius: 8px 8px 0 0;
             margin: -26px -26px 20px -26px;
             background: linear-gradient(135deg, var(--accent-color) 0%, var(--primary-color) 100%);
             color: var(--header-text-color);
             display: flex;
             justify-content: space-between;
             align-items: center;
             flex-wrap: wrap;
             gap: 15px;
             position: relative;
             box-shadow: inset 0 -2px 5px rgba(0,0,0,0.1);
         }
         .train-header h2 {
             margin: 0;
             font-weight: 700;
             color: var(--header-text-color);
             flex-grow: 1;
             display: flex;
             align-items: center;
             gap: 10px;
         }
         .train-subheader {
             text-align: right;
             font-size: 0.95rem;
             opacity: 0.95;
             flex-shrink: 0;
         }
         .train-subheader div { margin-top: 4px; display: flex; align-items: center; gap: 6px; justify-content: flex-end;}
         .train-subheader i { font-size: 0.9em; opacity: 0.8;}

         /* Print Button */
         .print-button {
             background: rgba(255, 255, 255, 0.15);
             border: 1px solid rgba(255, 255, 255, 0.3);
             color: var(--header-text-color);
             padding: 8px 15px;
             border-radius: 20px;
             cursor: pointer;
             font-size: 0.85rem;
             transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
             display: inline-flex;
             align-items: center;
             gap: 6px;
             margin-left: 15px;
         }
         .print-button:hover {
              background: rgba(255, 255, 255, 0.3);
              border-color: rgba(255, 255, 255, 0.5);
              transform: scale(1.03);
         }

         /* Info Section */
         .info-section {
             display: flex;
             gap: 25px;
             margin-bottom: 25px;
             flex-wrap: wrap;
         }
         .info-box {
             background-color: var(--highlight-bg);
             border-left: 4px solid var(--highlight-border);
             padding: 20px;
             border-radius: 6px;
             flex: 2;
             min-width: 300px;
             transition: background-color 0.3s ease;
             box-shadow: 0 2px 4px rgba(0,0,0,0.05);
         }
         .info-box h3 {
             margin-top: 0;
             margin-bottom: 15px;
             color: var(--secondary-color);
             font-size: 1.2rem;
             border-bottom: 1px solid var(--border-color);
             padding-bottom: 8px;
             display: flex;
             align-items: center;
             gap: 8px;
         }
         body.dark-mode .info-box h3 { color: var(--accent-color); border-bottom-color: var(--border-color);}
         .info-box p, .info-box div.amenity {
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
         }
         .info-box p strong { color: var(--primary-color); font-weight: 500; }
         body.dark-mode .info-box p strong { color: var(--accent-color); }
         .info-box .amenity i {
            color: var(--info-color);
            width: 18px;
            text-align: center;
            flex-shrink: 0;
         }
         body.dark-mode .info-box .amenity i { color: var(--accent-color); }

         .train-image {
             flex: 1;
             background-color: var(--bg-color);
             border-radius: 6px;
             display: flex;
             justify-content: center;
             align-items: center;
             overflow: hidden;
             min-width: 250px;
             max-height: 230px;
             border: 1px solid var(--border-color);
             box-shadow: 0 3px 8px rgba(0,0,0,0.08);
         }
          body.dark-mode .train-image { background-color: #2c2c2c; border-color: #555;}
         .train-image img {
             width: 100%;
             height: 100%;
             object-fit: cover;
             transition: transform 0.3s ease;
         }
         .train-image:hover img {
             transform: scale(1.03);
         }

        /* Speed Chart */
        /* ... (Speed chart styles remain the same) ... */
        .speed-chart {
            background-color: var(--highlight-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
         .speed-chart h3 {
             margin-top: 0;
             margin-bottom: 10px;
             color: var(--secondary-color);
             font-size: 1.2rem;
             display: flex;
             align-items: center;
             gap: 8px;
         }
         body.dark-mode .speed-chart h3 { color: var(--accent-color); }
         .speed-chart p { font-size: 0.9rem; margin-bottom: 5px; }
         .speed-chart strong { color: var(--primary-color); font-weight: 500;}
         body.dark-mode .speed-chart strong { color: var(--accent-color); }
         .speed-chart small { font-size: 0.85em; color: var(--text-muted-color); }

        /* Table Styles */
        /* ... (Table styles remain largely the same) ... */
        .table-container {
            box-shadow: 0 4px 12px var(--shadow-color);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            transition: border-color 0.3s ease;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg-color);
            transition: background-color 0.3s ease;
            min-width: 600px;
        }

        th {
            background-color: var(--table-header-bg);
            color: var(--table-header-text);
            padding: 14px 12px;
            text-align: left;
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: background-color 0.3s ease, color 0.3s ease;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        th i { margin-right: 6px; }

        td {
            padding: 12px 12px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
            vertical-align: middle;
            white-space: nowrap;
        }
         td.station-name, td.notes {
             white-space: normal;
         }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: var(--highlight-bg);
        }
        body.dark-mode tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .station-name .icon, .station-name .flag-icon {
            font-size: 1.2em;
            margin-right: 8px;
            vertical-align: middle;
            display: inline-block;
            text-align: center;
            min-width: 20px;
        }
         .station-name .fa-icon {
             font-size: 1.1em;
             margin-right: 8px;
             vertical-align: middle;
             width: 20px;
             display: inline-block;
             text-align: center;
             color: var(--primary-color);
             transition: color 0.2s ease;
         }
        body.dark-mode .station-name .fa-icon { color: var(--accent-color); }

        .highlight {
            font-weight: 700;
            color: var(--secondary-color);
        }
         body.dark-mode .highlight { color: var(--header-text-color); }

        .time {
            font-family: var(--font-mono);
            font-weight: 500;
            white-space: nowrap;
        }

        .duration, .stop-duration {
            background-color: #e9ecef;
            border-radius: 12px;
            padding: 3px 10px;
            font-size: 0.85em;
            white-space: nowrap;
            color: #495057;
            display: inline-block;
            border: 1px solid #ced4da;
            text-align: center;
            min-width: 50px;
            font-style: normal;
        }
         .duration.no-stop, .stop-duration.no-stop {
             background: transparent;
             border: none;
             color: var(--text-muted-color);
             font-style: italic;
         }
         body.dark-mode .duration, body.dark-mode .stop-duration {
             background-color: #495057;
             color: #dee2e6;
             border-color: #6c757d;
         }
         body.dark-mode .duration.no-stop, body.dark-mode .stop-duration.no-stop {
             background: transparent;
             border: none;
             color: var(--text-muted-color);
         }
        .stop-duration.short-stop { color: #666; border-color: #ccc;}
        .stop-duration.medium-stop { color: #333; font-weight: 500; border-color: #bbb;}
        .stop-duration.long-stop { color: var(--danger-color); background-color: #f8d7da; font-weight: 600; border-color: #f5c6cb;}
        body.dark-mode .stop-duration.short-stop { color: #bbb; border-color: #555;}
        body.dark-mode .stop-duration.medium-stop { color: #eee; border-color: #777;}
        body.dark-mode .stop-duration.long-stop { color: #f5c6cb; background-color: #3e1a1f; border-color: #c62828;}

        td.notes {
            font-size: 0.9em;
            color: var(--text-muted-color);
        }

        tr.start td:first-child { border-left: 4px solid var(--success-color); padding-left: 10px;}
        tr.major-stop td:first-child { border-left: 4px solid var(--info-color); padding-left: 10px;}
        tr.end td:first-child { border-left: 4px solid var(--danger-color); padding-left: 10px;}

        /* ... (Icon color definitions remain the same) ... */
        .start .station-name .fa-icon { color: var(--success-color); }
        .end .station-name .fa-icon { color: var(--danger-color); }
        .major-stop .station-name .fa-icon { color: var(--info-color); }
        /* ... etc ... */


        /* --- Footer --- */
        /* ... (Footer styles remain the same) ... */
        .main-footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted-color);
            font-size: 0.85rem;
            transition: border-color 0.3s ease, color 0.3s ease;
        }
        .main-footer p { margin-bottom: 8px; }
        .main-footer strong { color: var(--text-color); font-weight: 500; }
        body.dark-mode .main-footer strong { color: var(--text-muted-color); }

        .footer-links {
             margin-bottom: 15px;
             display: flex;
             justify-content: center;
             gap: 20px;
             flex-wrap: wrap;
        }
        .footer-links a {
             color: var(--text-muted-color);
             transition: color 0.2s ease;
             display: inline-flex;
             align-items: center;
             gap: 5px;
        }
         .footer-links a:hover { color: var(--primary-color); text-decoration: none;}
         body.dark-mode .footer-links a:hover { color: var(--accent-color); }

        /* Error Reporting Section */
        .error-reporting {
            background-color: var(--highlight-bg);
            padding: 15px 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            text-align: center;
            font-size: 0.9rem;
        }
        body.dark-mode .error-reporting {
            background-color: var(--card-bg-color);
        }
        .error-reporting p { margin-bottom: 10px; }
        .report-button { /* Changed from <a> to <button> */
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--header-text-color);
            padding: 8px 18px;
            border-radius: 20px;
            font-weight: 500;
            transition: background-color 0.2s ease, transform 0.1s ease;
            border: none; /* Button reset */
            cursor: pointer;
            font-family: inherit; /* Inherit font */
        }
        .report-button:hover {
             background-color: var(--secondary-color);
             color: var(--header-text-color);
             text-decoration: none;
             transform: scale(1.03);
        }
         body.dark-mode .report-button {
             background-color: var(--accent-color);
             color: #1a1a1a;
         }
          body.dark-mode .report-button:hover {
             background-color: var(--primary-color);
             color: var(--header-text-color);
         }

        /* --- Error Reporting Modal Styles --- */
        /* ... (Modal styles remain the same) ... */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-overlay-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: var(--modal-bg);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--modal-border);
            position: relative;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }
        .modal-close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--text-muted-color);
            cursor: pointer;
            line-height: 1;
            padding: 5px;
        }
        .modal-close-button:hover {
            color: var(--danger-color);
        }
        .modal-content h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        body.dark-mode .modal-content h3 {
             color: var(--accent-color);
        }
        .modal-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text-muted-color);
        }
        body.dark-mode .modal-form label { color: var(--text-muted-color); }
        .modal-form input[type="text"],
        .modal-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--input-border-color);
            border-radius: 5px;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .modal-form input[type="text"]:focus,
        .modal-form textarea:focus {
            outline: none;
            border-color: var(--input-focus-border-color);
            box-shadow: 0 0 0 3px rgba(var(--input-focus-border-color), 0.25);
        }
        .modal-form textarea {
            min-height: 120px;
            resize: vertical;
        }
        .modal-submit-button {
            display: block;
            width: 100%;
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: var(--header-text-color);
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }
        .modal-submit-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.02);
        }
         body.dark-mode .modal-submit-button {
             background-color: var(--accent-color);
             color: #1a1a1a;
         }
          body.dark-mode .modal-submit-button:hover {
             background-color: var(--primary-color);
             color: var(--header-text-color);
         }
         #modal-feedback {
            margin-top: 15px;
            font-size: 0.9em;
            text-align: center;
            color: var(--danger-color);
         }

        /* --- Chatbot Styles --- */
        #chat-toggle-button {
            position: fixed;
            bottom: 25px;
            right: calc(var(--side-decoration-width) + 25px); /* Adjust for side decoration */
            background-color: var(--primary-color);
            color: var(--header-text-color);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 998; /* Below modal overlay */
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        #chat-toggle-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }
        body.dark-mode #chat-toggle-button {
             background-color: var(--accent-color);
             color: #1a1a1a;
        }
         body.dark-mode #chat-toggle-button:hover {
             background-color: var(--primary-color);
             color: var(--header-text-color);
         }

        #chat-widget {
            position: fixed;
            bottom: 100px; /* Position above the toggle button */
            right: calc(var(--side-decoration-width) + 25px); /* Adjust for side decoration */
            width: 90%;
            max-width: 380px;
            height: 70vh;
            max-height: 500px;
            background-color: var(--card-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 999; /* Below modal overlay, above toggle */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
        }
         #chat-widget.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        #chat-header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 100%);
            color: var(--header-text-color);
            padding: 12px 15px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            border-bottom: 1px solid var(--border-color);
        }
         #chat-header-title {
            display: flex;
            align-items: center;
            gap: 8px;
         }
         #chat-header-title i { font-size: 1.1rem; }
         #chat-close-button {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
            padding: 2px 5px;
            transition: color 0.2s ease;
         }
         #chat-close-button:hover {
             color: #ffffff;
         }

        #chat-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .chat-message {
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .chat-message.user {
            background-color: var(--chat-user-bg);
            color: var(--chat-text-color);
            border-bottom-right-radius: 5px;
            margin-left: auto; /* Align user messages to the right */
            align-self: flex-end;
        }
         .chat-message.bot {
            background-color: var(--chat-bot-bg);
            color: var(--chat-text-color);
            border-bottom-left-radius: 5px;
            margin-right: auto; /* Align bot messages to the left */
            align-self: flex-start;
        }
        .chat-message.bot strong { font-weight: 600; }
        /* Typing indicator styles */
         .chat-message.typing-indicator {
             background-color: var(--chat-bot-bg);
             color: var(--chat-text-color);
             border-bottom-left-radius: 5px;
             margin-right: auto;
             align-self: flex-start;
             padding: 10px 15px;
             display: inline-flex; /* Use inline-flex */
             align-items: center;
         }
         .typing-dot {
             width: 8px;
             height: 8px;
             background-color: var(--chat-text-color);
             border-radius: 50%;
             margin: 0 3px;
             opacity: 0.7;
             animation: typing-blink 1.4s infinite both;
         }
         .typing-dot:nth-child(1) { animation-delay: 0s; }
         .typing-dot:nth-child(2) { animation-delay: 0.2s; }
         .typing-dot:nth-child(3) { animation-delay: 0.4s; }

         @keyframes typing-blink {
             0% { opacity: 0.2; }
             20% { opacity: 1; }
             100% { opacity: 0.2; }
         }


        #chat-input-container {
            display: flex;
            padding: 10px 15px;
            border-top: 1px solid var(--border-color);
            background-color: var(--card-bg-color); /* Match widget bg */
            flex-shrink: 0;
        }
        #chat-input {
            flex-grow: 1;
            padding: 10px 12px;
            border: 1px solid var(--input-border-color);
            border-radius: 20px;
            margin-right: 8px;
            font-size: 0.95rem;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            outline: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        #chat-input:focus {
            border-color: var(--input-focus-border-color);
            box-shadow: 0 0 0 2px rgba(var(--input-focus-border-color), 0.2);
        }
        #chat-send-button {
            background-color: var(--primary-color);
            color: var(--header-text-color);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-shrink: 0;
            transition: background-color 0.2s ease;
        }
         #chat-send-button:hover {
            background-color: var(--secondary-color);
        }
         body.dark-mode #chat-send-button {
             background-color: var(--accent-color);
             color: #1a1a1a;
         }
          body.dark-mode #chat-send-button:hover {
             background-color: var(--primary-color);
             color: var(--header-text-color);
         }


        /* --- Print Styles --- */
        @media print {
            /* ... (Print styles remain largely the same, ensure chatbot is hidden) ... */
             #chat-toggle-button, #chat-widget, .error-reporting, .main-header, .train-selector, .theme-switcher, .disclaimer-box, .main-footer, .train-image, .speed-chart, .confirmation-banner, .print-button, .header-search, #search-feedback, .font-size-controls, .language-selector, .error-reporting, .authenticity-banner, #error-report-modal {
                display: none !important;
            }
             body { padding: 0 !important; /* Reset body padding for print */ }
            /* ... rest of print styles ... */
             html::before, html::after { display: none !important; } /* Hide side decorations */

            .container { max-width: 100%; margin: 0; padding: 0; }
            .train-content {
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 0 20pt 0 !important;
                display: none;
            }
            .train-content.active-for-print {
                 display: block !important;
            }
             .train-content.active-for-print .train-header {
                 background: #eee !important;
                 color: #000 !important;
                 padding: 10pt !important;
                 margin: 0 0 10pt 0 !important;
                 border-radius: 0 !important;
                 border-bottom: 1px solid #ccc !important;
                 -webkit-print-color-adjust: exact;
                 print-color-adjust: exact;
             }
             .train-content.active-for-print .train-header h2 { font-size: 14pt !important; color: #000 !important; }
             .train-content.active-for-print .train-subheader { font-size: 9pt !important; color: #333 !important; }
             .train-content.active-for-print .info-section,
             .train-content.active-for-print .speed-chart,
             .train-content.active-for-print .confirmation-banner,
             .train-content.active-for-print .authenticity-banner {
                 display: none !important;
             }

            .table-container { box-shadow: none !important; border: 1px solid #ccc !important; margin: 0 !important; border-radius: 0 !important; overflow: visible !important; }
            table { width: 100%; background: #fff !important; min-width: unset !important;}
            th {
                background-color: #ddd !important;
                color: #000 !important;
                font-size: 8pt !important;
                padding: 6pt 4pt !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                position: static !important;
            }
            td {
                 border-bottom: 1px solid #ccc !important;
                 font-size: 9pt !important;
                 padding: 5pt 4pt !important;
                 vertical-align: top;
                 white-space: normal !important;
             }
             td:first-child { padding-left: 4pt !important; border-left: none !important; }

            tr:hover { background-color: transparent !important; }
             tr.start td:first-child, tr.major-stop td:first-child, tr.end td:first-child {
                 border-left-width: 3pt !important;
                 border-left-style: solid !important;
                 padding-left: 2pt !important;
                 -webkit-print-color-adjust: exact;
                 print-color-adjust: exact;
             }
             tr.start td:first-child { border-left-color: var(--success-color) !important; }
             tr.major-stop td:first-child { border-left-color: var(--info-color) !important; }
             tr.end td:first-child { border-left-color: var(--danger-color) !important; }
            .station-name .icon, .station-name .flag-icon { font-size: 1em !important; display: none !important; }
            .station-name .fa-icon { display: none !important; }
             .duration, .stop-duration {
                 border: 1px solid #aaa !important;
                 background: #eee !important;
                 color: #000 !important;
                 font-size: 0.8em !important;
                 padding: 1pt 3pt !important;
                 -webkit-print-color-adjust: exact;
                 print-color-adjust: exact;
             }
             .duration.no-stop, .stop-duration.no-stop {
                 border: none !important;
                 background: transparent !important;
                 color: #555 !important;
             }
             a { text-decoration: none !important; color: #000 !important; }
        }

        /* --- Media Queries --- */
         @media (max-width: 992px) {
             html::before, html::after { width: calc(var(--side-decoration-width) / 2); } /* Reduce side decoration width */
             /* Adjust chat button position */
             #chat-toggle-button { right: calc(var(--side-decoration-width) / 2 + 15px); bottom: 15px;}
             #chat-widget { right: calc(var(--side-decoration-width) / 2 + 15px); bottom: 85px; }

             body {
                 padding-left: calc(var(--side-decoration-width) / 2 + 15px);
                 padding-right: calc(var(--side-decoration-width) / 2 + 15px);
             }
             .header-search { flex-basis: 280px; }
             .header-controls { justify-content: center; }
             .info-section { gap: 20px; }
             .info-box { min-width: 280px; }
             .train-image { min-width: 200px; max-height: 200px;}
         }
         @media (max-width: 768px) {
             html::before, html::after { display: none; } /* Hide side decorations completely */
             body { padding: 15px; } /* Reset padding for smaller screens */
             /* Adjust chat button position again */
             #chat-toggle-button { right: 15px; bottom: 15px; width: 55px; height: 55px; font-size: 1.6rem;}
             #chat-widget { right: 15px; bottom: 80px; max-width: calc(100vw - 30px); max-height: 60vh;}

             h1 { font-size: 1.9rem; }
             h2 { font-size: 1.6rem; }
             .main-header { flex-direction: column; text-align: center; gap: 15px; padding: 15px 20px;}
             .header-search { width: 100%; max-width: 450px; margin: 0 auto; }
             .header-controls { margin-top: 10px; justify-content: center; gap: 8px;}
             .control-group { padding: 4px 8px; }
             .time-date { text-align: center; order: -1; }
             .info-section { flex-direction: column; }
             .train-header { flex-direction: column; text-align: center; gap: 10px; padding: 15px 20px; }
             .train-subheader { text-align: center; }
             .train-subheader div { justify-content: center; }
             .print-button { margin-left: 0; margin-top: 10px; }
             .modal-content { width: 95%; padding: 20px;}
         }
         @media (max-width: 480px) {
            html { --base-font-size: 15px; }
            body { padding: 10px; }
            #chat-toggle-button { right: 10px; bottom: 10px; width: 50px; height: 50px; font-size: 1.5rem;}
            #chat-widget { right: 10px; bottom: 70px; max-width: calc(100vw - 20px); max-height: 65vh;}
             #chat-messages { padding: 10px; }
             .chat-message { font-size: 0.9rem; padding: 8px 12px;}
             #chat-input-container { padding: 8px 10px; }
             #chat-input { font-size: 0.9rem; padding: 8px 10px; }
             #chat-send-button { width: 36px; height: 36px; font-size: 1.1rem;}


            h1 { font-size: 1.6rem; }
            h2 { font-size: 1.4rem; }
            .header-title h1 { flex-direction: column; gap: 5px; }
            .header-title p { font-size: 0.85rem; }
            .train-selector button { font-size: 0.85rem; padding: 8px 12px; gap: 5px;}
            .train-header h2 { font-size: 1.3rem; gap: 8px; }
             th { font-size: 0.8rem; padding: 10px 8px; }
             td { font-size: 0.9rem; padding: 10px 8px; }
             .control-group button:not(.lang-option) { font-size: 0.8rem; padding: 5px 8px; }
             /* Language selector specific */
             #current-lang-display img { width: 18px; }
             .lang-option { padding: 5px 8px; font-size: 0.85rem; }
             .lang-option img { width: 16px; }
             /* ------------- */
             .footer-links { gap: 15px; }
             .error-reporting { padding: 12px 15px; }
             .report-button { padding: 6px 15px; font-size: 0.9rem; }
             .modal-content { padding: 15px; }
             .modal-close-button { font-size: 1.5rem; top: 5px; right: 10px; }
             .modal-form input[type="text"], .modal-form textarea { font-size: 0.95rem; padding: 8px;}
             .modal-submit-button { padding: 10px 15px; font-size: 0.95rem; }
         }

    </style>
</head>
<body>

    <div class="container">

        <header class="main-header">
            <!-- Header content remains the same -->
             <div class="header-title">
                <h1 data-translate-key="header.title"><i class="fas fa-train-subway"></i> Rozkłady PKP ICC</h1>
                <p data-translate-key="header.subtitle">Nieoficjalny serwis informacyjny</p>
            </div>
            <div class="header-search">
                <input type="search" id="train-search-input" placeholder="Wyszukaj pociąg (np. 18170 lub UZNAM)" data-translate-key="search.placeholder">
                <button id="train-search-button" aria-label="Wyszukaj pociąg" data-translate-key="search.button.aria">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            <div class="header-controls">
                <div class="time-date">
                    <div id="current-date"></div>
                    <div id="current-time"></div>
                </div>
                <div class="control-group font-size-controls">
                     <button id="decrease-font" aria-label="Zmniejsz czcionkę" data-translate-key="fontsize.decrease.aria"><i class="fas fa-minus"></i></button>
                     <button id="reset-font" aria-label="Resetuj rozmiar czcionki" data-translate-key="fontsize.reset.aria"><i class="fas fa-text-height"></i></button>
                     <button id="increase-font" aria-label="Powiększ czcionkę" data-translate-key="fontsize.increase.aria"><i class="fas fa-plus"></i></button>
                </div>
                 <!-- UPDATED Language Selector Structure -->
                 <div class="control-group language-selector">
                    <div id="current-lang-display" tabindex="0" aria-label="Current Language / Change Language">
                        <img id="current-lang-flag" src="" alt="Current language flag"> <!-- JS will set src -->
                    </div>
                    <div class="language-options">
                        <button class="lang-option" data-lang="pl" aria-label="Język: Polski">
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAYAAAB24g05AAAAPElEQVQokWNgwA78//8/AyUYQBFgACQyMDEyMrgAKTIwsjAwgKLiAaQyhNQJgAKD5AACg2chIMPAAICpACPaAeQMAAAAAElFTkSuQmCC" alt="PL">
                            <span data-translate-key="lang.pl">Polski</span>
                        </button>
                        <button class="lang-option" data-lang="en" aria-label="Language: English">
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAYAAAB24g05AAACJGlDQ1BJQ0MgUHJvZmlsZQAAeAGtkAlIz+kUxKnPzFGcMbNRkvGhKVj+kXJMyUhQjEkLCEtKk9ttr90v7/0f79798117h8AUsP/k4wAUwGwADGVyJAQDgL1U4dWyJg4AEEgD4wQYfiyTIGgARAdgNAIEC7J8SAI+AWEAaAOYAMnMvAOMAJgQW4AXAFwAUIAZIBsQBewBIoA/IAFkAZ/z/+/9fAPkPAIC7LkAAAIB7LgAA5r+DAEBanh8MAMA3LhwEAEAZa8P6BNA+m6eTAHgmT38OALwL+LwBAERijwQA9gJMAeAvAEQDyALwDyAGwBBA7gAwANwKcJ7AP8A4AZwfIZvAWQBvAGEBGAGSAIQC2AG6AS4A3oA/IAUGAZwBkgB5gC1gBdgCHgEpgBRgA7gBtAGOAF9AmABsgBdAKzAUGAQqAw4BDYBDoAhYAsoA04BTQDrQBLQCTQBewBcwDFgH5gDZgKzAEfAMWAXeAPWAc8Bp4AR4Av4A/4A3wC/wBoQDFkEPgg5CDMIaQhdCGkIOwg9CCIIGYhZCFKIMYhfiDiISohdiLGIaYjXiN4IqYjZiW2IzYA/kHskJyQPJDckLyQ3JD8kTyQfJE8lFyRvJbckdSQcJBMkNySnJIcpjyiPKT8pkCkDKaIpqSldKYMpPylCKYcoPyhtKWIpWynXKbcofylnKY8p5yoPKl8pXylXKb8p4KFkoWCgOKiAqZCqMKvopAynHKYcp3yn8KkMqcyoXKr8r8FS4KthVGKr4q9hQeWMoqviopKk4qdyptKv8pIKrIquSq6KrEqySrmq/ypPKr0qPSpoKmoqviqhKo4qPyqsKr4qsKrnqv/b/AK7h/isAAAAlUExURf///wAAAAD//wD/AAAAAAD/AP8A/wAAAP8A/wAAAE5lcQAAAMxydQAAAAp0Uk5TABEHENuAjbue5fEuAAAAZElEQVQY02NggID/EMDAwAABAwMDEwME/zAwMzAxMQESBgaGAAGiAgYGBoDAAAAUKQYQGBgA84dCDAwgBwNCAAKhAgYHCAAKhAkYHCgADIAAFEAAMCAAoABWAAx4ARQ4BAAAAPfBAgB4AAIAmBvL8aR5QvQAAAAASUVORK5CYII=" alt="EN">
                            <span data-translate-key="lang.en">English</span>
                        </button>
                        <button class="lang-option" data-lang="de" aria-label="Sprache: Deutsch">
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAIAAAD5gJpuAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAHBSURBVHjaYmQgAFhYWP/ABMz/Hx8MDAz////3AxL+//7+//+f/Pz//xkYGLiR4eEQf+Hh4f8vLCxMAgU3DwYGBgYGRkYGBgYGBkbw+/v///8vLy//h4SE/wsLC/8vLi7+J0BOACYGDgYGCDAxMYAnM7Ozs+Pi4v/n5+f/aWlp/wkJCf8PDw/+/f39//fv3//z8/P//v7+/wsKCv8fHx//9/f3//Hx8QAQ/v7+8fFx8cDAoKCgIEBAbGBgYFBQkP//Hx//8PDw/xISEv/v7+//jY2N/wMDw/+/v7//7+/v/wYGBv/a2tr/7+/v/wcHB//j4+P/AwPD/xwcHP/v7+9/f3///xkZGSIIyqioKCgoKAQEBARERETFxcW3t7dLS0uLi4ubm5uXl5ejo6OkpKSoqKhXV1ePj4+Li4uVlZWLi4svLCywsLDi4uKysrKurq6bm5uUlJSMjIyMjIz/AAMAwAEAZ765gKAAAAAASUVORK5CYII=" alt="DE">
                             <span data-translate-key="lang.de">Deutsch</span>
                        </button>
                        <button class="lang-option" data-lang="zh" aria-label="语言: 中文">
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAIAAAD5gJpuAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAHeSURBVHjaYnRwcv9DIwODhISE/8PBwT8gQOACAwODAwP/HzAQEP8/MDAoKSn9Dw8P/7///x0YGLgYFhZ+NjQ0+Pf398e/v/+Bif+fn5//J0BEpGZmZuZXV1f/AwPDBwsKCn91dXW/j4+P/wcHB/8XFxf/l5eX/zs7O/8MDAy8tLS0BAQE/Bsbm/8zMzN5eXmFhYX5+flTU1MUl5QMDAxcMDAwcTAwMMDAAAEGAAKQB6u/0HAAAAAASUVORK5CYII=" alt="ZH">
                             <span data-translate-key="lang.zh">中文</span>
                        </button>
                        <button class="lang-option" data-lang="ua" aria-label="Мова: Українська">
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAIAAAD5gJpuAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAEBSURBVHjaYnx+/xcDAwPD/38YMP7///9/bt68AQMFNTQ0/f//nxkYGLiYmpqaJiUl/f//nxkYGPQEBwf9Pz8/Lycn9//f/x8YGBgY+P/fP5gYGLgYQkJCnJyccOrUKY6Oji6urq5fAPFoaWnx8/NLOzs7SUlJf+fOnS8gIKCiooIgQG9ublJSUlpaWmJiYpKSkr+/v3/79m36+vr+/v3b0dFxcnISFBSUmJjY3Nz848ePMzIysrKyyMvLS0tLQxAQkJaWlp+fHxwc/OPjIx4eHkZGRhISEoCAgP7+/v7+/mNjYxMTExUVFSAgIFBQUBAQEAMDAwACDAAEa8d2GPGw0QAAAABJRU5ErkJggg==" alt="UA">
                            <span data-translate-key="lang.ua">Українська</span>
                        </button>
                        <button class="lang-option" data-lang="ru" aria-label="Язык: Русский">
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAYAAAB24g05AAAAWklEQVQokWNgwA78//8/AymAGZkMMjAwMOD/RxYGhgNUDQLI//9/BgYGfn5+///z8xMQIAAQBJycnFyMjIx+fn6A8uPFzMjIwMDw4A+uMDAwMjAwQJmBBYAAQAEy4wDbxGZuAAAAAElFTkSuQmCC" alt="RU">
                            <span data-translate-key="lang.ru">Русский</span>
                        </button>
                    </div>
                 </div>
                 <!-- END Language Selector -->
                <div class="control-group theme-switcher">
                    <button id="theme-toggle-button" aria-label="Zmień motyw" data-translate-key="theme.toggle.aria">
                        <i class="fas fa-sun"></i> <!-- JS will correct -->
                    </button>
                </div>
            </div>
        </header>

        <div id="search-feedback"></div> <!-- Search feedback area -->

        <div class="disclaimer-box">
             <i class="fas fa-exclamation-triangle"></i>
             <div data-translate-key="disclaimer.text">
                 <strong>Ważna informacja:</strong> Ta strona jest projektem nieoficjalnym i ma charakter wyłącznie poglądowy. Zawsze sprawdzaj aktualny rozkład jazdy, skład pociągu oraz ewentualne zmiany bezpośrednio na oficjalnej stronie PKP Intercity (<a href="https://www.intercity.pl" target="_blank" rel="noopener noreferrer">www.intercity.pl</a>) lub w innych oficjalnych kanałach przewoźnika przed podróżą. Autorzy strony nie ponoszą odpowiedzialności za ewentualne nieścisłości.
             </div>
        </div>

        <div class="train-selector">
            <button id="select-uznam" data-train-number="18170" data-train-name="UZNAM" class="active"><i class="fas fa-train"></i> IC 18170 UZNAM</button>
            <button id="select-galczynski" data-train-number="1856" data-train-name="GAŁCZYŃSKI"><i class="fas fa-train"></i> IC 1856 GAŁCZYŃSKI</button>
            <button id="select-tatry" data-train-number="1350" data-train-name="TATRY"><i class="fas fa-mountain"></i> EIP 1350 TATRY</button>
            <button id="select-slowiniec" data-train-number="15102" data-train-name="SŁOWINIEC"><i class="fas fa-ship"></i> IC 15102 SŁOWINIEC</button>
            <button id="select-ec246" data-train-number="246" data-train-name="Berlin-Warszawa Express"><i class="fas fa-city"></i> EC 246 BWE</button>
            <button id="select-ec265" data-train-number="265" data-train-name="Baltic Express"><i class="fas fa-anchor"></i> EC 265 Baltic</button>
            <!-- Add more buttons here -->
        </div>

        <!-- Train Content sections -->
        <!-- == Train Content: IC 18170 "UZNAM" == -->
        <div id="uznam-content" class="train-content active">
             <div class="train-header">
                 <h2><i class="fas fa-train"></i> IC 18170 "UZNAM"</h2>
                 <div class="train-subheader">
                   <div data-translate-key="route.warsaw.swinoujscie"><i class="fas fa-route"></i> Warszawa Wschodnia → Świnoujście</div>
                   <div data-translate-key="uznam.travel.time"><i class="far fa-clock"></i> Czas podróży: ~8h 40min</div>
                 </div>
                 <button class="print-button" data-translate-key="button.print"><i class="fas fa-print"></i> Drukuj Rozkład</button>
            </div>
            <div class="authenticity-banner">
                <i class="fas fa-check-circle"></i>
                <div data-translate-key="authenticity.note">
                    <strong>Gwarancja Autora (stan na 02.04.2025):</strong> Dane dotyczące trasy i podstawowego składu (lokomotywa + typ wagonów) zostały zweryfikowane przez autora strony i są zgodne z najlepszą wiedzą na podany dzień. Mogą jednak wystąpić zmiany operacyjne. Zawsze potwierdzaj szczegóły u przewoźnika.
                </div>
            </div>
             <div class="info-section">
                <div class="info-box">
                  <h3 data-translate-key="info.composition"><i class="fas fa-info-circle"></i> Informacje o składzie</h3>
                  <p><strong data-translate-key="info.rolling_stock">Typ taboru:</strong> Lokomotywa EP07 + Wagony Standardowe</p>
                  <p><strong data-translate-key="info.max_speed">Prędkość maksymalna:</strong> Do 125 km/h (EP07)</p>
                  <div class="amenity" data-translate-key="amenity.ac"><i class="fas fa-snowflake"></i> Klimatyzacja (w wybranych wagonach)</div>
                  <div class="amenity" data-translate-key="amenity.sockets"><i class="fas fa-plug"></i> Gniazdka elektryczne (dostępność zmienna)</div>
                  <div class="amenity" data-translate-key="amenity.wifi.rare"><i class="fas fa-wifi"></i> WiFi (rzadko dostępne w tym typie składu)</div>
                  <div class="amenity" data-translate-key="amenity.catering.possible"><i class="fas fa-utensils"></i> Możliwy wagon barowy/catering mobilny (sprawdź)</div>
                </div>
                <div class="train-image">
                  <!-- === IMAGE FIXED === -->
                  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0a/EP07-1026_z_IC_Sukiennice.jpg/1024px-EP07-1026_z_IC_Sukiennice.jpg" alt="Ilustracja pociągu Intercity (skład wagonowy z lokomotywą EP07)">
                </div>
            </div>
             <div class="speed-chart">
                <h3 data-translate-key="info.speed.section"><i class="fas fa-tachometer-alt"></i> Prędkość na odcinkach trasy (orientacyjna)</h3>
                <p>Warszawa - Poznań: <strong>~100-120 km/h</strong> | Poznań - Szczecin: <strong>~100-120 km/h</strong> | Szczecin - Świnoujście: <strong>~80-100 km/h</strong></p>
                <p><small data-translate-key="info.speed.disclaimer">*Prędkości ograniczone możliwościami lokomotywy EP07 i stanem infrastruktury. Mogą się różnić w zależności od warunków.</small></p>
             </div>
            <div class="table-container">
                 <!-- UZNAM Table Content remains the same -->
                  <table>
                  <thead>
                    <tr>
                      <th data-translate-key="table.header.station"><i class="fas fa-map-marker-alt"></i> Stacja / Przystanek</th>
                      <th data-translate-key="table.header.arrival"><i class="far fa-clock"></i> Przyjazd</th>
                      <th data-translate-key="table.header.departure"><i class="fas fa-sign-out-alt"></i> Odjazd</th>
                      <th data-translate-key="table.header.stopover"><i class="fas fa-stopwatch"></i> Postój</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="start">
                      <td class="station-name"><span class="icon">🏙️</span> <span class="highlight" data-translate-key="station.warsaw_east">Warszawa Wschodnia</span></td>
                      <td>—</td>
                      <td class="time highlight">22:39</td>
                      <td><span class="duration no-stop">—</span></td>
                    </tr>
                    <tr class="major-stop">
                      <td class="station-name"><span class="icon">🏛️</span> <span class="highlight" data-translate-key="station.warsaw_central">Warszawa Centralna</span></td>
                      <td class="time">22:45</td>
                      <td class="time highlight">22:50</td>
                      <td><span class="duration">5 min</span></td>
                    </tr>
                    <tr>
                      <td class="station-name"><span class="icon">🚆</span> <span data-translate-key="station.warsaw_west">Warszawa Zachodnia</span></td>
                      <td class="time">22:54</td>
                      <td class="time">22:55</td>
                      <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-building"></i></span> <span data-translate-key="station.sochaczew">Sochaczew</span></td>
                        <td class="time">23:26</td>
                        <td class="time">23:27</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-archway"></i></span> <span data-translate-key="station.lowicz_glowny">Łowicz Główny</span></td>
                        <td class="time">23:43</td>
                        <td class="time">23:44</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-industry"></i></span> <span data-translate-key="station.kutno">Kutno</span></td>
                        <td class="time">00:09</td>
                        <td class="time">00:10</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-ring"></i></span> <span data-translate-key="station.kolo">Koło</span></td>
                        <td class="time">00:38</td>
                        <td class="time">00:39</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-industry"></i></span> <span data-translate-key="station.konin">Konin</span></td>
                        <td class="time">00:55</td>
                        <td class="time">00:56</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-tree"></i></span> <span data-translate-key="station.slupca">Słupca</span></td>
                        <td class="time">01:12</td>
                        <td class="time">01:13</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-bread-slice"></i></span> <span data-translate-key="station.wrzesnia">Września</span></td>
                        <td class="time">01:28</td>
                        <td class="time">01:29</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-home"></i></span> <span data-translate-key="station.swarzedz">Swarzędz</span></td>
                        <td class="time">01:51</td>
                        <td class="time">01:52</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr class="major-stop">
                        <td class="station-name"><span class="icon">🐐</span> <span class="highlight" data-translate-key="station.poznan_glowny">Poznań Główny</span></td>
                        <td class="time">02:03</td>
                        <td class="time highlight">02:12</td>
                        <td><span class="duration">9 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-tractor"></i></span> <span data-translate-key="station.opalenica">Opalenica</span></td>
                        <td class="time">02:39</td>
                        <td class="time">02:40</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-chair"></i></span> <span data-translate-key="station.nowy_tomysl">Nowy Tomyśl</span></td>
                        <td class="time">02:51</td>
                        <td class="time">02:52</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-music"></i></span> <span data-translate-key="station.zbaszyn">Zbąszyń</span></td>
                        <td class="time">03:05</td>
                        <td class="time">03:06</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-random"></i></span> <span data-translate-key="station.zbaszynek">Zbąszynek</span></td>
                        <td class="time">03:12</td>
                        <td class="time">03:13</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-cross"></i></span> <span data-translate-key="station.swiebodzin">Świebodzin</span></td>
                        <td class="time">03:26</td>
                        <td class="time">03:27</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-project-diagram"></i></span> <span data-translate-key="station.rzepin">Rzepin</span></td>
                        <td class="time">03:55</td>
                        <td class="time">03:56</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-chess-rook"></i></span> <span data-translate-key="station.kostrzyn">Kostrzyn</span></td>
                        <td class="time">04:18</td>
                        <td class="time">04:19</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-tree"></i></span> <span data-translate-key="station.mieszkowice">Mieszkowice</span></td>
                        <td class="time">04:34</td>
                        <td class="time">04:35</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-church"></i></span> <span data-translate-key="station.chojna">Chojna</span></td>
                        <td class="time">04:49</td>
                        <td class="time">04:50</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-dragon"></i></span> <span data-translate-key="station.gryfino">Gryfino</span></td>
                        <td class="time">05:11</td>
                        <td class="time">05:12</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr class="major-stop">
                      <td class="station-name"><span class="icon">🏙️</span> <span class="highlight" data-translate-key="station.szczecin_glowny">Szczecin Główny</span></td>
                      <td class="time">05:28</td>
                      <td class="time highlight">05:53</td>
                      <td><span class="duration">25 min</span></td>
                    </tr>
                    <tr>
                      <td class="station-name"><span class="fa-icon"><i class="fas fa-anchor"></i></span> <span data-translate-key="station.szczecin_dabie">Szczecin Dąbie</span></td>
                      <td class="time">06:06</td>
                      <td class="time">06:08</td>
                      <td><span class="duration">2 min</span></td>
                    </tr>
                    <tr>
                      <td class="station-name"><span class="icon">✈️</span> <span data-translate-key="station.goleniow">Goleniów</span></td>
                      <td class="time">06:24</td>
                      <td class="time">06:25</td>
                      <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                      <td class="station-name"><span class="fa-icon"><i class="fas fa-water"></i></span> <span data-translate-key="station.wysoka_kamienska">Wysoka Kamieńska</span></td>
                      <td class="time">06:42</td>
                      <td class="time">06:43</td>
                      <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr>
                      <td class="station-name"><span class="icon">🏖️</span> <span data-translate-key="station.miedzyzdroje">Międzyzdroje</span></td>
                      <td class="time">07:04</td>
                      <td class="time">07:06</td>
                      <td><span class="duration">2 min</span></td>
                    </tr>
                    <tr class="end">
                      <td class="station-name"><span class="icon">🌊</span> <span class="highlight" data-translate-key="station.swinoujscie">Świnoujście</span></td>
                      <td class="time highlight">07:19</td>
                      <td>—</td>
                      <td><span class="duration no-stop">—</span></td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
        <!-- == End Train Content: IC 18170 "UZNAM" == -->

        <!-- == Train Content: IC 1856 "GAŁCZYŃSKI" == -->
        <div id="galczynski-content" class="train-content">
             <!-- GAŁCZYŃSKI content remains the same -->
              <div class="train-header">
                 <h2><i class="fas fa-train"></i> IC 1856 "GAŁCZYŃSKI"</h2>
                 <div class="train-subheader">
                   <div data-translate-key="route.warsaw.swinoujscie"><i class="fas fa-route"></i> Warszawa Wschodnia → Świnoujście</div>
                   <div data-translate-key="galczynski.travel.time"><i class="far fa-clock"></i> Czas podróży: ~6h 54min</div>
                 </div>
                  <button class="print-button" data-translate-key="button.print"><i class="fas fa-print"></i> Drukuj Rozkład</button>
            </div>
             <div class="authenticity-banner">
                <i class="fas fa-check-circle"></i>
                <div data-translate-key="authenticity.note">
                    <strong>Gwarancja Autora (stan na 02.04.2025):</strong> Dane dotyczące trasy i podstawowego składu (lokomotywa + typ wagonów) zostały zweryfikowane przez autora strony i są zgodne z najlepszą wiedzą na podany dzień. Mogą jednak wystąpić zmiany operacyjne. Zawsze potwierdzaj szczegóły u przewoźnika.
                </div>
            </div>
             <div class="info-section">
                <div class="info-box">
                  <h3 data-translate-key="info.composition"><i class="fas fa-info-circle"></i> Informacje o składzie (przykładowe)</h3>
                  <p><strong data-translate-key="info.rolling_stock">Typ taboru:</strong> Lokomotywa EU160 (Husarz) + Wagony standardowe</p>
                  <p><strong data-translate-key="info.max_speed">Prędkość maksymalna:</strong> Do 160 km/h (na wybranych odcinkach)</p>
                  <div class="amenity" data-translate-key="amenity.ac.mostly"><i class="fas fa-snowflake"></i> Klimatyzacja (w większości wagonów)</div>
                  <div class="amenity" data-translate-key="amenity.sockets"><i class="fas fa-plug"></i> Gniazdka elektryczne (dostępność zmienna)</div>
                  <div class="amenity" data-translate-key="amenity.wifi.possible"><i class="fas fa-wifi"></i> WiFi (może być dostępne, sprawdź)</div>
                  <div class="amenity" data-translate-key="amenity.wars"><i class="fas fa-utensils"></i> Wagon barowy/bistro WARS (sprawdź dostępność)</div>
                </div>
                 <div class="train-image">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/EU160-015_PKPIC.jpg/1024px-EU160-015_PKPIC.jpg" alt="Lokomotywa EU160 Husarz PKP Intercity">
                 </div>
            </div>
             <div class="table-container">
                <!-- GAŁCZYŃSKI Table Content remains the same -->
                <table>
                  <thead>
                    <tr>
                      <th data-translate-key="table.header.station"><i class="fas fa-map-marker-alt"></i> Stacja / Przystanek</th>
                      <th data-translate-key="table.header.arrival"><i class="far fa-clock"></i> Przyjazd</th>
                      <th data-translate-key="table.header.departure"><i class="fas fa-sign-out-alt"></i> Odjazd</th>
                      <th data-translate-key="table.header.stopover"><i class="fas fa-stopwatch"></i> Postój</th>
                    </tr>
                  </thead>
                  <tbody>
                     <tr class="start">
                        <td class="station-name"><span class="icon">🏙️</span> <span class="highlight" data-translate-key="station.warsaw_east">Warszawa Wschodnia</span></td>
                        <td>—</td>
                        <td class="time highlight">05:14</td>
                        <td><span class="duration no-stop">—</span></td>
                     </tr>
                     <tr class="major-stop">
                        <td class="station-name"><span class="icon">🏛️</span> <span class="highlight" data-translate-key="station.warsaw_central">Warszawa Centralna</span></td>
                        <td class="time">05:20</td>
                        <td class="time highlight">05:30</td>
                        <td><span class="duration">10 min</span></td>
                     </tr>
                     <tr>
                        <td class="station-name"><span class="icon">🚆</span> <span data-translate-key="station.warsaw_west">Warszawa Zachodnia</span></td>
                        <td class="time">05:34</td>
                        <td class="time">05:35</td>
                        <td><span class="duration">1 min</span></td>
                     </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-building"></i></span> <span data-translate-key="station.sochaczew">Sochaczew</span></td>
                        <td class="time">06:01</td>
                        <td class="time">06:02</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-archway"></i></span> <span data-translate-key="station.lowicz_glowny">Łowicz Główny</span></td>
                        <td class="time">06:15</td>
                        <td class="time">06:16</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-industry"></i></span> <span data-translate-key="station.kutno">Kutno</span></td>
                        <td class="time">06:36</td>
                        <td class="time">06:37</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-ring"></i></span> <span data-translate-key="station.kolo">Koło</span></td>
                        <td class="time">07:00</td>
                        <td class="time">07:01</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-industry"></i></span> <span data-translate-key="station.konin">Konin</span></td>
                        <td class="time">07:14</td>
                        <td class="time">07:15</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-tree"></i></span> <span data-translate-key="station.slupca">Słupca</span></td>
                        <td class="time">07:28</td>
                        <td class="time">07:29</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-bread-slice"></i></span> <span data-translate-key="station.wrzesnia">Września</span></td>
                        <td class="time">07:41</td>
                        <td class="time">07:42</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-home"></i></span> <span data-translate-key="station.swarzedz">Swarzędz</span></td>
                        <td class="time">08:02</td>
                        <td class="time">08:03</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr class="major-stop">
                        <td class="station-name"><span class="icon">🐐</span> <span class="highlight" data-translate-key="station.poznan_glowny">Poznań Główny</span></td>
                        <td class="time">08:23</td>
                        <td class="time highlight">08:37</td>
                        <td><span class="duration">14 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-city"></i></span> <span data-translate-key="station.szamotuly">Szamotuły</span></td>
                        <td class="time">08:54</td>
                        <td class="time">08:55</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-industry"></i></span> <span data-translate-key="station.wronki">Wronki</span></td>
                        <td class="time">09:04</td>
                        <td class="time">09:05</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-code-branch"></i></span> <span data-translate-key="station.krzyz">Krzyż</span></td>
                        <td class="time">09:21</td>
                        <td class="time">09:22</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-leaf"></i></span> <span data-translate-key="station.dobiegniew">Dobiegniew</span></td>
                        <td class="time">09:33</td>
                        <td class="time">09:34</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-landmark"></i></span> <span data-translate-key="station.choszczno">Choszczno</span></td>
                        <td class="time">09:48</td>
                        <td class="time">09:49</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-star"></i></span> <span data-translate-key="station.stargard">Stargard</span></td>
                        <td class="time">10:06</td>
                        <td class="time">10:08</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-anchor"></i></span> <span data-translate-key="station.szczecin_dabie">Szczecin Dąbie</span></td>
                        <td class="time">10:24</td>
                        <td class="time">10:25</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr class="major-stop">
                        <td class="station-name"><span class="icon">🏙️</span> <span class="highlight" data-translate-key="station.szczecin_glowny">Szczecin Główny</span></td>
                        <td class="time">10:38</td>
                        <td class="time highlight">10:43</td>
                        <td><span class="duration">5 min</span></td>
                     </tr>
                     <tr> <!-- Double stop in Szczecin Dąbie -->
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-anchor"></i></span> <span data-translate-key="station.szczecin_dabie">Szczecin Dąbie</span></td>
                        <td class="time">10:56</td>
                        <td class="time">10:57</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="icon">✈️</span> <span data-translate-key="station.goleniow">Goleniów</span></td>
                        <td class="time">11:14</td>
                        <td class="time">11:16</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-water"></i></span> <span data-translate-key="station.wysoka_kamienska">Wysoka Kamieńska</span></td>
                        <td class="time">11:34</td>
                        <td class="time">11:36</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🏖️</span> <span data-translate-key="station.miedzyzdroje">Międzyzdroje</span></td>
                        <td class="time">11:56</td>
                        <td class="time">11:58</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                     <tr class="end">
                        <td class="station-name"><span class="icon">🌊</span> <span class="highlight" data-translate-key="station.swinoujscie">Świnoujście</span></td>
                        <td class="time highlight">12:08</td>
                        <td>—</td>
                        <td><span class="duration no-stop">—</span></td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
        <!-- == End Train Content: IC 1856 "GAŁCZYŃSKI" == -->

        <!-- == Train Content: EIP 1350 "TATRY" == -->
        <div id="tatry-content" class="train-content">
           <!-- TATRY content remains the same -->
            <div class="train-header">
                 <h2><i class="fas fa-train"></i> EIP 1350 "TATRY"</h2>
                 <div class="train-subheader">
                   <div data-translate-key="route.warsaw.zakopane"><i class="fas fa-route"></i> Warszawa Wschodnia → Zakopane</div>
                   <div data-translate-key="tatry.travel.time"><i class="far fa-clock"></i> Czas podróży: ~4h 57min</div>
                 </div>
                  <button class="print-button" data-translate-key="button.print"><i class="fas fa-print"></i> Drukuj Rozkład</button>
            </div>
             <div class="authenticity-banner">
                <i class="fas fa-check-circle"></i>
                <div data-translate-key="authenticity.note">
                    <strong>Gwarancja Autora (stan na 02.04.2025):</strong> Dane dotyczące trasy i podstawowego składu (lokomotywa + typ wagonów) zostały zweryfikowane przez autora strony i są zgodne z najlepszą wiedzą na podany dzień. Mogą jednak wystąpić zmiany operacyjne. Zawsze potwierdzaj szczegóły u przewoźnika.
                </div>
            </div>
             <div class="info-section">
                <div class="info-box">
                  <h3 data-translate-key="info.composition"><i class="fas fa-info-circle"></i> Informacje o składzie</h3>
                  <p><strong data-translate-key="info.rolling_stock">Typ taboru:</strong> ED250 (Pendolino)</p>
                   <p><strong data-translate-key="info.max_speed">Prędkość maksymalna:</strong> Do 200 km/h (na CMK)</p>
                  <div class="amenity" data-translate-key="amenity.ac"><i class="fas fa-snowflake"></i> Klimatyzacja</div>
                  <div class="amenity" data-translate-key="amenity.sockets"><i class="fas fa-plug"></i> Gniazdka elektryczne</div>
                  <div class="amenity" data-translate-key="amenity.wifi.usually"><i class="fas fa-wifi"></i> WiFi (zazwyczaj dostępne)</div>
                  <div class="amenity" data-translate-key="amenity.wars"><i class="fas fa-utensils"></i> Wagon barowy/bistro WARS</div>
                  <div class="amenity" data-translate-key="amenity.classes"><i class="fas fa-business-time"></i> Klasa Biznes, 1 i 2</div>
                  <div class="amenity" data-translate-key="amenity.reservation"><i class="fas fa-info-circle"></i> Obowiązkowa rezerwacja miejsc</div>
                </div>
                 <div class="train-image">
                     <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/ED250-004_at_Warszawa_Wschodnia_railway_station.jpg/1024px-ED250-004_at_Warszawa_Wschodnia_railway_station.jpg" alt="Pociąg Pendolino (ED250) PKP Intercity">
                 </div>
            </div>
            <div class="speed-chart">
                <h3 data-translate-key="info.speed.section"><i class="fas fa-tachometer-alt"></i> Prędkość na odcinkach trasy (orientacyjna)</h3>
                <p>Warszawa - Kraków (CMK): <strong>~160-200 km/h</strong> | Kraków - Zakopane: <strong>~50-80 km/h</strong> (odcinek górski)</p>
                <p><small data-translate-key="info.speed.disclaimer.cmk">*Najwyższe prędkości osiągane na Centralnej Magistrali Kolejowej. Prędkość na odcinku górskim znacznie niższa ze względu na charakterystykę linii.</small></p>
            </div>
            <div class="table-container">
                <!-- TATRY Table Content remains the same -->
                <table>
                  <thead>
                    <tr>
                      <th data-translate-key="table.header.station"><i class="fas fa-map-marker-alt"></i> Stacja / Przystanek</th>
                      <th data-translate-key="table.header.arrival"><i class="far fa-clock"></i> Przyjazd</th>
                      <th data-translate-key="table.header.departure"><i class="fas fa-sign-out-alt"></i> Odjazd</th>
                      <th data-translate-key="table.header.stopover"><i class="fas fa-stopwatch"></i> Postój</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="start">
                        <td class="station-name"><span class="icon">🏙️</span> <span class="highlight" data-translate-key="station.warsaw_east">Warszawa Wschodnia</span></td>
                        <td>—</td>
                        <td class="time highlight">07:29</td>
                        <td><span class="duration no-stop">—</span></td>
                    </tr>
                    <tr class="major-stop">
                        <td class="station-name"><span class="icon">🏛️</span> <span class="highlight" data-translate-key="station.warsaw_central">Warszawa Centralna</span></td>
                        <td class="time">07:35</td>
                        <td class="time highlight">07:40</td>
                        <td><span class="duration">5 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🚆</span> <span data-translate-key="station.warsaw_west">Warszawa Zachodnia</span></td>
                        <td class="time">07:44</td>
                        <td class="time">07:46</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-route"></i></span> <span data-translate-key="station.idzikowice">Idzikowice (CMK)</span></td>
                        <td class="time" colspan="2" data-translate-key="table.technical_passage">Przejazd techniczny</td>
                        <td><span class="duration no-stop">—</span></td>
                    </tr>
                    <tr class="major-stop">
                        <td class="station-name"><span class="icon">🐉</span> <span class="highlight" data-translate-key="station.krakow_glowny">Kraków Główny</span></td>
                        <td class="time">10:02</td>
                        <td class="time highlight">10:19</td>
                        <td><span class="duration">17 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🐑</span> <span data-translate-key="station.nowy_targ">Nowy Targ</span></td>
                        <td class="time">12:08</td>
                        <td class="time">12:09</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr class="end">
                        <td class="station-name"><span class="icon">⛰️</span> <span class="highlight" data-translate-key="station.zakopane">Zakopane</span></td>
                        <td class="time highlight">12:26</td>
                        <td>—</td>
                        <td><span class="duration no-stop">—</span></td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
        <!-- == End Train Content: EIP 1350 "TATRY" == -->

         <!-- == Train Content: IC 15102 "SŁOWINIEC" == -->
        <div id="slowiniec-content" class="train-content">
           <!-- SŁOWINIEC content remains the same -->
            <div class="train-header">
                 <h2><i class="fas fa-train"></i> IC 15102 "SŁOWINIEC"</h2>
                 <div class="train-subheader">
                   <div data-translate-key="route.lodz.gdynia"><i class="fas fa-route"></i> Łódź Fabryczna → Gdynia Główna</div>
                   <div data-translate-key="slowiniec.travel.time"><i class="far fa-clock"></i> Czas podróży: ~5h 05min</div>
                 </div>
                  <button class="print-button" data-translate-key="button.print"><i class="fas fa-print"></i> Drukuj Rozkład</button>
            </div>
             <div class="authenticity-banner">
                <i class="fas fa-check-circle"></i>
                <div data-translate-key="authenticity.note">
                    <strong>Gwarancja Autora (stan na 02.04.2025):</strong> Dane dotyczące trasy i podstawowego składu (lokomotywa + typ wagonów) zostały zweryfikowane przez autora strony i są zgodne z najlepszą wiedzą na podany dzień. Mogą jednak wystąpić zmiany operacyjne. Zawsze potwierdzaj szczegóły u przewoźnika.
                </div>
            </div>
             <div class="info-section">
                <div class="info-box">
                  <h3 data-translate-key="info.composition"><i class="fas fa-info-circle"></i> Informacje o składzie (przykładowe)</h3>
                  <p><strong data-translate-key="info.rolling_stock">Typ taboru:</strong> Lokomotywa EU160 (Husarz) + Wagony standardowe</p>
                  <p><strong data-translate-key="info.max_speed">Prędkość maksymalna:</strong> Do 160 km/h (na wybranych odcinkach)</p>
                   <div class="amenity" data-translate-key="amenity.ac.mostly"><i class="fas fa-snowflake"></i> Klimatyzacja (w większości wagonów)</div>
                  <div class="amenity" data-translate-key="amenity.sockets"><i class="fas fa-plug"></i> Gniazdka elektryczne (dostępność zmienna)</div>
                  <div class="amenity" data-translate-key="amenity.wifi.possible"><i class="fas fa-wifi"></i> WiFi (może być dostępne, sprawdź)</div>
                  <div class="amenity" data-translate-key="amenity.wars"><i class="fas fa-utensils"></i> Wagon barowy/bistro WARS (sprawdź dostępność)</div>
                </div>
                 <div class="train-image">
                     <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/EU160-015_PKPIC.jpg/1024px-EU160-015_PKPIC.jpg" alt="Lokomotywa EU160 Husarz PKP Intercity">
                 </div>
            </div>
            <div class="table-container">
                <!-- SŁOWINIEC Table Content remains the same -->
                <table>
                  <thead>
                    <tr>
                      <th data-translate-key="table.header.station"><i class="fas fa-map-marker-alt"></i> Stacja / Przystanek</th>
                      <th data-translate-key="table.header.arrival"><i class="far fa-clock"></i> Przyjazd</th>
                      <th data-translate-key="table.header.departure"><i class="fas fa-sign-out-alt"></i> Odjazd</th>
                      <th data-translate-key="table.header.stopover"><i class="fas fa-stopwatch"></i> Postój</th>
                    </tr>
                  </thead>
                   <tbody>
                    <tr class="start">
                        <td class="station-name"><span class="icon">🏭</span> <span class="highlight" data-translate-key="station.lodz_fabryczna">Łódź Fabryczna</span></td>
                        <td>—</td>
                        <td class="time highlight">07:33</td>
                        <td><span class="duration no-stop">—</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🚉</span> <span data-translate-key="station.lodz_widzew">Łódź Widzew</span></td>
                        <td class="time">07:39</td>
                        <td class="time">07:40</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-random"></i></span> <span data-translate-key="station.koluszki">Koluszki</span></td>
                        <td class="time">07:50</td>
                        <td class="time">07:51</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🍎</span> <span data-translate-key="station.skierniewice">Skierniewice</span></td>
                        <td class="time">08:10</td>
                        <td class="time">08:11</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-industry"></i></span> <span data-translate-key="station.zyrardow">Żyrardów</span></td>
                        <td class="time">08:22</td>
                        <td class="time">08:23</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr class="major-stop">
                        <td class="station-name"><span class="icon">🚆</span> <span class="highlight" data-translate-key="station.warsaw_west">Warszawa Zachodnia</span></td>
                        <td class="time">08:41</td>
                        <td class="time">08:42</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr class="major-stop">
                        <td class="station-name"><span class="icon">🏛️</span> <span class="highlight" data-translate-key="station.warsaw_central">Warszawa Centralna</span></td>
                        <td class="time">08:46</td>
                        <td class="time highlight">09:00</td>
                        <td><span class="duration">14 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🏙️</span> <span data-translate-key="station.warsaw_east">Warszawa Wschodnia</span></td>
                        <td class="time">09:06</td>
                        <td class="time">09:08</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-tree"></i></span> <span data-translate-key="station.legionowo">Legionowo</span></td>
                        <td class="time">09:22</td>
                        <td class="time">09:23</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="icon">✈️</span> <span data-translate-key="station.nowy_dwor_maz">Nowy Dwór Mazowiecki</span></td>
                        <td class="time">09:31</td>
                        <td class="time">09:32</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-castle"></i></span> <span data-translate-key="station.ciechanow">Ciechanów</span></td>
                        <td class="time">09:58</td>
                        <td class="time">09:59</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-city"></i></span> <span data-translate-key="station.mlawa_miasto">Mława Miasto</span></td>
                        <td class="time">10:13</td>
                        <td class="time">10:14</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🚂</span> <span data-translate-key="station.dzialdowo">Działdowo</span></td>
                        <td class="time">10:24</td>
                        <td class="time">10:25</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr class="major-stop">
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-water"></i></span> <span class="highlight" data-translate-key="station.ilawa_glowna">Iława Główna</span></td>
                        <td class="time">10:56</td>
                        <td class="time highlight">10:58</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                     <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-landmark"></i></span> <span data-translate-key="station.prabuty">Prabuty</span></td>
                        <td class="time">11:15</td>
                        <td class="time">11:24</td>
                        <td><span class="duration">9 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🧱</span> <span data-translate-key="station.malbork">Malbork</span></td>
                        <td class="time">11:42</td>
                        <td class="time">11:44</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-archway"></i></span> <span data-translate-key="station.tczew">Tczew</span></td>
                        <td class="time">11:55</td>
                        <td class="time">11:56</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                     <tr class="major-stop">
                        <td class="station-name"><span class="icon">⚓</span> <span class="highlight" data-translate-key="station.gdansk_glowny">Gdańsk Główny</span></td>
                        <td class="time">12:12</td>
                        <td class="time highlight">12:15</td>
                        <td><span class="duration">3 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">⚽</span> <span data-translate-key="station.gdansk_wrzeszcz">Gdańsk Wrzeszcz</span></td>
                        <td class="time">12:18</td>
                        <td class="time">12:19</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="fa-icon"><i class="fas fa-tree"></i></span> <span data-translate-key="station.gdansk_oliwa">Gdańsk Oliwa</span></td>
                        <td class="time">12:22</td>
                        <td class="time">12:23</td>
                        <td><span class="duration">1 min</span></td>
                    </tr>
                    <tr>
                        <td class="station-name"><span class="icon">🏖️</span> <span data-translate-key="station.sopot">Sopot</span></td>
                        <td class="time">12:27</td>
                        <td class="time">12:29</td>
                        <td><span class="duration">2 min</span></td>
                    </tr>
                     <tr class="end">
                        <td class="station-name"><span class="icon">🚢</span> <span class="highlight" data-translate-key="station.gdynia_glowna">Gdynia Główna</span></td>
                        <td class="time highlight">12:38</td>
                        <td>—</td>
                        <td><span class="duration no-stop">—</span></td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>
        <!-- == End Train Content: IC 15102 "SŁOWINIEC" == -->

        <!-- == Train Content: EC 246 BWE == -->
        <div id="ec246-content" class="train-content">
            <!-- EC 246 content remains the same -->
             <div class="train-header">
                 <h2><i class="fas fa-city"></i> EC 246 Berlin-Warszawa Express</h2>
                 <div class="train-subheader">
                   <div data-translate-key="route.warsaw.berlin"><i class="fas fa-route"></i> Warszawa Wschodnia → Berlin Hbf</div>
                   <div data-translate-key="ec246.travel.time"><i class="far fa-clock"></i> Czas podróży: ~5h 17min</div>
                 </div>
                  <button class="print-button" data-translate-key="button.print"><i class="fas fa-print"></i> Drukuj Rozkład</button>
            </div>
             <div class="authenticity-banner">
                <i class="fas fa-check-circle"></i>
                <div data-translate-key="authenticity.note">
                    <strong>Gwarancja Autora (stan na 02.04.2025):</strong> Dane dotyczące trasy i podstawowego składu (lokomotywa + typ wagonów) zostały zweryfikowane przez autora strony i są zgodne z najlepszą wiedzą na podany dzień. Mogą jednak wystąpić zmiany operacyjne. Zawsze potwierdzaj szczegóły u przewoźnika.
                </div>
            </div>
             <div class="info-section">
                 <div class="info-box">
                  <h3 data-translate-key="info.composition"><i class="fas fa-info-circle"></i> Informacje o składzie</h3>
                  <p><strong data-translate-key="info.rolling_stock">Typ taboru:</strong> Lokomotywa EU44 (Husarz / Siemens ES64U4) + Wagony standardowe</p>
                   <p><strong data-translate-key="info.max_speed">Prędkość maksymalna:</strong> Do 160 km/h (na odcinkach PL), do 200 km/h (na odcinkach DE, możliwości lokomotywy)</p>
                   <div class="amenity" data-translate-key="amenity.ac.mostly"><i class="fas fa-snowflake"></i> Klimatyzacja (w większości wagonów)</div>
                   <div class="amenity" data-translate-key="amenity.sockets"><i class="fas fa-plug"></i> Gniazdka elektryczne</div>
                   <div class="amenity" data-translate-key="amenity.wifi.possible"><i class="fas fa-wifi"></i> WiFi (może być dostępne, sprawdź)</div>
                   <div class="amenity" data-translate-key="amenity.wars"><i class="fas fa-utensils"></i> Wagon barowy/bistro WARS</div>
                 </div>
                 <div class="train-image">
                     <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/99/PKPIC_EU44_Husarz.jpg/1024px-PKPIC_EU44_Husarz.jpg" alt="Lokomotywa EU44 Husarz PKP Intercity">
                 </div>
            </div>
             <div class="table-container">
                <!-- EC 246 Table Content remains the same -->
                 <table class="schedule-table">
                    <thead>
                        <tr>
                            <th data-translate-key="table.header.station"><i class="fas fa-map-marker-alt"></i> Stacja</th>
                            <th data-translate-key="table.header.arrival"><i class="far fa-clock"></i> Przyjazd</th>
                            <th data-translate-key="table.header.departure"><i class="fas fa-sign-out-alt"></i> Odjazd</th>
                            <th data-translate-key="table.header.stopover"><i class="fas fa-stopwatch"></i> Postój</th>
                            <th data-translate-key="table.header.notes"><i class="fas fa-info-circle"></i> Uwagi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="start">
                            <td class="station-name"><span class="flag-icon">🇵🇱</span> <span class="highlight" data-translate-key="station.warsaw_east">Warszawa Wschodnia</span></td>
                            <td class="time">—</td>
                            <td class="time highlight">06:49</td>
                            <td class="stop-duration no-stop">—</td>
                            <td class="notes" data-translate-key="notes.start_eic246">Początek trasy EIC 246</td>
                        </tr>
                        <tr class="major-stop">
                            <td class="station-name"><span class="icon">🏙️</span> <span class="highlight" data-translate-key="station.warsaw_central">Warszawa Centralna</span></td>
                            <td class="time">06:55</td>
                            <td class="time highlight">06:59</td>
                            <td class="stop-duration medium-stop">4 min</td>
                            <td class="notes"></td>
                        </tr>
                        <tr>
                            <td class="station-name"><span class="icon">🏢</span> <span data-translate-key="station.warsaw_west">Warszawa Zachodnia</span></td>
                            <td class="time">07:03</td>
                            <td class="time">07:05</td>
                            <td class="stop-duration short-stop">2 min</td>
                            <td class="notes"></td>
                        </tr>
                        <tr>
                            <td class="station-name"><span class="icon">🏭</span> <span data-translate-key="station.kutno">Kutno</span></td>
                            <td class="time">08:00</td>
                            <td class="time">08:01</td>
                            <td class="stop-duration short-stop">1 min</td>
                            <td class="notes"></td>
                        </tr>
                        <tr>
                            <td class="station-name"><span class="icon">🏘️</span> <span data-translate-key="station.konin">Konin</span></td>
                            <td class="time">08:37</td>
                            <td class="time">08:38</td>
                            <td class="stop-duration short-stop">1 min</td>
                            <td class="notes"></td>
                        </tr>
                        <tr class="major-stop">
                            <td class="station-name"><span class="icon">🐐</span> <span class="highlight" data-translate-key="station.poznan_glowny">Poznań Główny</span></td>
                            <td class="time">09:23</td>
                            <td class="time highlight">09:31</td>
                            <td class="stop-duration long-stop">8 min</td>
                            <td class="notes" data-translate-key="notes.major_hub">Główny węzeł przesiadkowy</td>
                        </tr>
                         <tr>
                            <td class="station-name"><span class="icon">🌲</span> <span data-translate-key="station.zbaszynek">Zbąszynek</span></td>
                            <td class="time">10:10</td>
                            <td class="time">10:11</td>
                            <td class="stop-duration short-stop">1 min</td>
                            <td class="notes"></td>
                        </tr>
                         <tr>
                            <td class="station-name"><span class="icon">🗽</span> <span data-translate-key="station.swiebodzin">Świebodzin</span></td>
                            <td class="time">10:23</td>
                            <td class="time">10:24</td>
                            <td class="stop-duration short-stop">1 min</td>
                            <td class="notes" data-translate-key="notes.swiebodzin_statue">Figura Chrystusa Króla</td>
                        </tr>
                        <tr class="major-stop">
                            <td class="station-name"><span class="icon">↔️</span> <span class="highlight" data-translate-key="station.rzepin">Rzepin</span></td>
                            <td class="time">10:47</td>
                            <td class="time highlight">10:50</td>
                            <td class="stop-duration medium-stop">3 min</td>
                            <td class="notes" data-translate-key="notes.change_to_ec246">Zmiana numeru na EC 246</td>
                        </tr>
                        <tr>
                            <td class="station-name"><span class="icon">🛂</span> <span data-translate-key="station.frankfurt_oder_gr">Frankfurt(Oder)(Gr)</span></td>
                            <td class="time">—</td>
                            <td class="time">—</td>
                            <td class="stop-duration no-stop" data-translate-key="table.passage">Przejazd</td>
                            <td class="notes" data-translate-key="notes.border_pl_de">Granica państwa PL/DE</td>
                        </tr>
                        <tr class="major-stop">
                            <td class="station-name"><span class="flag-icon">🇩🇪</span> <span class="highlight" data-translate-key="station.frankfurt_oder">Frankfurt(Oder)</span></td>
                            <td class="time">11:09</td>
                            <td class="time highlight">11:12</td>
                            <td class="stop-duration medium-stop">3 min</td>
                            <td class="notes" data-translate-key="notes.first_stop_de">Pierwszy postój w Niemczech</td>
                        </tr>
                         <tr>
                            <td class="station-name"><span class="icon">🖼️</span> <span data-translate-key="station.berlin_ostbahnhof">Berlin Ostbahnhof</span></td>
                            <td class="time">11:55</td>
                            <td class="time">—</td>
                             <td class="stop-duration no-stop">—</td>
                            <td class="notes" data-translate-key="notes.east_side_gallery">Blisko East Side Gallery</td>
                        </tr>
                         <tr class="end">
                            <td class="station-name"><span class="icon">🏛️</span> <span class="highlight" data-translate-key="station.berlin_hbf">Berlin Hbf (Hauptbahnhof)</span></td>
                            <td class="time highlight">12:06</td>
                            <td class="time">—</td>
                             <td class="stop-duration no-stop">—</td>
                            <td class="notes" data-translate-key="notes.end_station">Stacja końcowa</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- == End Train Content: EC 246 BWE == -->

         <!-- == Train Content: EC 265 Baltic Express == -->
        <div id="ec265-content" class="train-content">
           <!-- EC 265 content remains the same -->
             <div class="train-header">
                 <h2><i class="fas fa-anchor"></i> EC 265 Baltic Express</h2>
                 <div class="train-subheader">
                   <div data-translate-key="route.gdynia.prague"><i class="fas fa-route"></i> Gdynia Główna → Praha hl.n.</div>
                   <div data-translate-key="ec265.travel.time"><i class="far fa-clock"></i> Czas podróży: ~9h 09min</div>
                 </div>
                  <button class="print-button" data-translate-key="button.print"><i class="fas fa-print"></i> Drukuj Rozkład</button>
            </div>
             <div class="authenticity-banner">
                <i class="fas fa-check-circle"></i>
                <div data-translate-key="authenticity.note">
                    <strong>Gwarancja Autora (stan na 02.04.2025):</strong> Dane dotyczące trasy i podstawowego składu (lokomotywa + typ wagonów) zostały zweryfikowane przez autora strony i są zgodne z najlepszą wiedzą na podany dzień. Mogą jednak wystąpić zmiany operacyjne. Zawsze potwierdzaj szczegóły u przewoźnika.
                </div>
            </div>
             <div class="info-section">
                 <div class="info-box">
                  <h3 data-translate-key="info.composition"><i class="fas fa-info-circle"></i> Informacje o składzie</h3>
                   <p><strong data-translate-key="info.rolling_stock">Typ taboru:</strong> Lokomotywa EU160 (Husarz) na odcinku PL, lokomotywa ČD na odcinku CZ + Wagony standardowe</p>
                   <p><strong data-translate-key="info.max_speed">Prędkość maksymalna:</strong> Do 160 km/h (na wybranych odcinkach)</p>
                    <div class="amenity" data-translate-key="amenity.ac.mostly"><i class="fas fa-snowflake"></i> Klimatyzacja (w większości wagonów)</div>
                  <div class="amenity" data-translate-key="amenity.sockets"><i class="fas fa-plug"></i> Gniazdka elektryczne (dostępność zmienna)</div>
                  <div class="amenity" data-translate-key="amenity.wifi.possible"><i class="fas fa-wifi"></i> WiFi (może być dostępne, sprawdź)</div>
                  <div class="amenity" data-translate-key="amenity.wars"><i class="fas fa-utensils"></i> Wagon barowy/bistro (sprawdź dostępność)</div>
                 </div>
                 <div class="train-image">
                     <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/EU160-015_PKPIC.jpg/1024px-EU160-015_PKPIC.jpg" alt="Lokomotywa EU160 Husarz PKP Intercity">
                 </div>
            </div>
            <div class="table-container">
                 <!-- EC 265 Table Content remains the same -->
                 <table class="route-table schedule-table"> <!-- Add schedule-table class -->
                    <thead>
                        <tr>
                            <th data-translate-key="table.header.station"><i class="fas fa-map-marker-alt"></i> Stacja</th>
                            <th data-translate-key="table.header.arrival"><i class="far fa-clock"></i> Przyjazd</th>
                            <th data-translate-key="table.header.departure"><i class="fas fa-sign-out-alt"></i> Odjazd</th>
                            <th data-translate-key="table.header.stopover"><i class="fas fa-stopwatch"></i> Postój</th>
                            <!--<th data-translate-key="table.header.notes"><i class="fas fa-info-circle"></i> Uwagi</th>-->
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="start">
                            <td class="station-name"><span class="flag-icon">🇵🇱</span> <span class="highlight" data-translate-key="station.gdynia_glowna">Gdynia Główna</span></td>
                            <td class="time">—</td>
                            <td class="time highlight">12:03</td>
                            <td class="stop-duration no-stop">—</td>
                        </tr>
                        <tr class="major-stop">
                            <td class="station-name"><span class="icon">🏗️</span> <span class="highlight" data-translate-key="station.gdansk_glowny">Gdańsk Główny</span></td>
                            <td class="time">12:25</td>
                            <td class="time highlight">12:29</td>
                            <td class="stop-duration medium-stop">4 min</td>
                        </tr>
                        <tr class="major-stop">
                            <td class="station-name"><span class="fa-icon"><i class="fas fa-bridge"></i></span> <span class="highlight" data-translate-key="station.bydgoszcz_glowna">Bydgoszcz Główna</span></td>
                            <td class="time">13:51</td>
                            <td class="time highlight">13:55</td>
                            <td class="stop-duration medium-stop">4 min</td>
                        </tr>
                        <tr>
                            <td class="station-name"><span class="fa-icon"><i class="fas fa-salt"></i></span> <span data-translate-key="station.inowroclaw">Inowrocław</span></td>
                            <td class="time">14:22</td>
                            <td class="time">14:23</td>
                            <td class="stop-duration short-stop">1 min</td>
                        </tr>
                        <tr>
                           <td class="station-name"><span class="fa-icon"><i class="fas fa-crown"></i></span> <span data-translate-key="station.gniezno">Gniezno</span></td>
                            <td class="time">14:53</td>
                            <td class="time">14:54</td>
                            <td class="stop-duration short-stop">1 min</td>
                        </tr>
                        <tr class="major-stop">
                           <td class="station-name"><span class="icon">🐐</span> <span class="highlight" data-translate-key="station.poznan_glowny">Poznań Główny</span></td>
                            <td class="time">15:20</td>
                            <td class="time highlight">15:31</td>
                            <td class="stop-duration long-stop">11 min</td>
                        </tr>
                        <tr>
                            <td class="station-name"><span class="fa-icon"><i class="fas fa-monument"></i></span> <span data-translate-key="station.leszno">Leszno</span></td>
                            <td class="time">16:04</td>
                            <td class="time">16:05</td>
                            <td class="stop-duration short-stop">1 min</td>
                        </tr>
                         <tr class="major-stop">
                            <td class="station-name"><span class="icon">🦁</span> <span class="highlight" data-translate-key="station.wroclaw_glowny">Wrocław Główny</span></td>
                            <td class="time">16:49</td>
                            <td class="time highlight">17:15</td>
                            <td class="stop-duration long-stop">26 min</td>
                        </tr>
                         <tr>
                            <td class="station-name"><span class="fa-icon"><i class="fas fa-draw-polygon"></i></span> <span data-translate-key="station.klodzko_miasto">Kłodzko Miasto</span></td>
                            <td class="time">18:18</td>
                            <td class="time">18:19</td>
                            <td class="stop-duration short-stop">1 min</td>
                        </tr>
                        <tr class="major-stop">
                            <td class="station-name"><span class="icon">🌲</span> <span class="highlight" data-translate-key="station.miedzylesie">Międzylesie</span></td>
                            <td class="time">18:45</td>
                            <td class="time highlight">18:49</td>
                            <td class="stop-duration medium-stop">4 min</td>
                        </tr>
                         <tr class="major-stop">
                            <td class="station-name"><span class="flag-icon">🇨🇿</span> <span class="highlight" data-translate-key="station.lichkov">Lichkov</span></td>
                            <td class="time">18:57</td>
                            <td class="time highlight">19:00</td>
                            <td class="stop-duration medium-stop">3 min</td>
                        </tr>
                         <tr>
                            <td class="station-name"><span class="flag-icon">🇨🇿</span> <span data-translate-key="station.usti_nad_orlici">Ústí nad Orlicí</span></td>
                            <td class="time">19:32</td>
                            <td class="time">19:34</td>
                            <td class="stop-duration short-stop">2 min</td>
                        </tr>
                         <tr class="major-stop">
                           <td class="station-name"><span class="fa-icon"><i class="fas fa-horse-head"></i></span> <span class="highlight" data-translate-key="station.pardubice">Pardubice hl.n.</span></td>
                            <td class="time">20:01</td>
                            <td class="time highlight">20:03</td>
                            <td class="stop-duration short-stop">2 min</td>
                        </tr>
                         <tr>
                            <td class="station-name"><span class="icon">🏭</span> <span data-translate-key="station.kolin">Kolín</span></td>
                            <td class="time">20:25</td>
                            <td class="time">20:27</td>
                            <td class="stop-duration short-stop">2 min</td>
                        </tr>
                        <tr class="end">
                            <td class="station-name"><span class="icon">🏰</span> <span class="highlight" data-translate-key="station.praha_hlavni">Praha hl.n.</span></td>
                            <td class="time highlight">21:12</td>
                            <td class="time">—</td>
                            <td class="stop-duration no-stop">—</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- == End Train Content: EC 265 Baltic Express == -->


        <footer class="main-footer">
            <div class="error-reporting">
                 <p data-translate-key="footer.error.prompt">Znalazłeś błąd lub masz sugestię? Daj nam znać!</p>
                 <button id="open-report-modal-button" class="report-button" data-translate-key="footer.error.button">
                    <i class="fas fa-envelope"></i> Zgłoś uwagę
                 </button>
            </div>
            <p>© <span id="current-year"></span> Nieoficjalny Projekt Rozkładów PKP ICC. Wszelkie Prawa Zastrzeżone (dla projektu).</p>
            <p data-translate-key="footer.disclaimer.data">Dane rozkładów jazdy i informacje o składach mają charakter poglądowy i mogą być nieaktualne. Zawsze weryfikuj informacje u źródła.</p>
            <p data-translate-key="footer.disclaimer.trademarks">Znaki towarowe PKP Intercity należą do ich prawnych właścicieli.</p>
            <div class="footer-links">
                 <a href="https://www.intercity.pl" target="_blank" rel="noopener noreferrer" title="Oficjalna strona PKP Intercity" data-translate-key="footer.link.official_site"><i class="fas fa-globe"></i> Oficjalna strona PKP Intercity</a>
            </div>
        </footer>

    </div> <!-- end .container -->

    <!-- Error Reporting Modal -->
    <div id="error-report-modal" class="modal-overlay">
        <!-- Modal content remains the same -->
        <div class="modal-content">
            <button id="modal-close-button" class="modal-close-button" aria-label="Zamknij okno">&times;</button>
            <h3 data-translate-key="modal.title">Zgłoś Błąd lub Sugestię</h3>
            <form id="error-report-form" class="modal-form">
                <div>
                    <label for="report-subject" data-translate-key="modal.subject">Temat:</label>
                    <input type="text" id="report-subject" name="subject" required>
                </div>
                <div>
                    <label for="report-description" data-translate-key="modal.description">Opis Problemu / Sugestia:</label>
                    <textarea id="report-description" name="description" required></textarea>
                </div>
                 <div id="modal-feedback" style="display: none;"></div> <!-- Feedback area inside modal -->
                <button type="submit" id="modal-submit-button" class="modal-submit-button" data-translate-key="modal.send">
                    <i class="fas fa-paper-plane"></i> Wyślij Zgłoszenie
                </button>
            </form>
        </div>
    </div>
    <!-- End Error Reporting Modal -->

    <!-- Chatbot Widget -->
    <button id="chat-toggle-button" aria-label="Otwórz czat pomocy" data-translate-key="chat.toggle.aria">
        <i class="fas fa-comments"></i>
    </button>

    <div id="chat-widget">
        <div id="chat-header">
            <div id="chat-header-title">
                 <i class="fas fa-robot"></i> <span data-translate-key="chat.header.title">Pomocnik Rozkładów</span>
            </div>
            <button id="chat-close-button" aria-label="Zamknij czat">&times;</button>
        </div>
        <div id="chat-messages">
            <!-- Chat messages will be appended here by JS -->
        </div>
        <div id="chat-input-container">
            <input type="text" id="chat-input" placeholder="Wpisz swoje pytanie..." data-translate-key="chat.input.placeholder">
            <button id="chat-send-button" aria-label="Wyślij wiadomość" data-translate-key="chat.send.aria">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    <!-- End Chatbot Widget -->


    <script>
        // --- Elements ---
        const timeElement = document.getElementById('current-time');
        const dateElement = document.getElementById('current-date');
        const yearElement = document.getElementById('current-year');
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const selectorButtons = document.querySelectorAll('.train-selector button');
        const trainContents = document.querySelectorAll('.train-content');
        const searchInput = document.getElementById('train-search-input');
        const searchButton = document.getElementById('train-search-button');
        const searchFeedback = document.getElementById('search-feedback');
        const printButtons = document.querySelectorAll('.print-button');
        const decreaseFontButton = document.getElementById('decrease-font');
        const resetFontButton = document.getElementById('reset-font');
        const increaseFontButton = document.getElementById('increase-font');
        const htmlElement = document.documentElement;
        // Language Selector Elements
        const currentLangDisplay = document.getElementById('current-lang-display');
        const currentLangFlag = document.getElementById('current-lang-flag');
        const langOptionButtons = document.querySelectorAll('.lang-option');
        const languageOptionsContainer = document.querySelector('.language-options'); // Container for dropdown
         // Error Modal Elements
        const errorReportModal = document.getElementById('error-report-modal');
        const openReportModalButton = document.getElementById('open-report-modal-button');
        const modalCloseButton = document.getElementById('modal-close-button');
        const errorReportForm = document.getElementById('error-report-form');
        const reportSubjectInput = document.getElementById('report-subject');
        const reportDescriptionInput = document.getElementById('report-description');
        const modalFeedback = document.getElementById('modal-feedback');
        // Chatbot Elements (KEEP THESE)
        const chatToggleButton = document.getElementById('chat-toggle-button');
        const chatWidget = document.getElementById('chat-widget');
        const chatCloseButton = document.getElementById('chat-close-button');
        const chatMessagesContainer = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendButton = document.getElementById('chat-send-button');


        // --- Data ---
        const trainDataMap = {}; // Map train number -> button ID
        const trainNameMap = {}; // Map lowercase train name -> button ID
        selectorButtons.forEach(button => {
            const trainNumber = button.dataset.trainNumber;
            const trainName = button.dataset.trainName;
            const buttonId = button.id;
            if (trainNumber) {
                trainDataMap[trainNumber] = buttonId;
            }
            if (trainName) {
                trainNameMap[trainName.toLowerCase()] = buttonId;
            }
        });

         // Store flag image sources for easy access
        const flagSources = {};
         langOptionButtons.forEach(btn => {
            const lang = btn.dataset.lang;
            const img = btn.querySelector('img');
            if (img) {
                flagSources[lang] = img.src;
            }
        });

        // --- Translation Data ---
        const translations = {
            pl: {
                "header.title": "Rozkłady PKP ICC",
                "header.subtitle": "Nieoficjalny serwis informacyjny",
                "search.placeholder": "Wyszukaj pociąg (np. 18170 lub UZNAM)",
                "search.button.aria": "Wyszukaj pociąg",
                "fontsize.decrease.aria": "Zmniejsz czcionkę",
                "fontsize.reset.aria": "Resetuj rozmiar czcionki",
                "fontsize.increase.aria": "Powiększ czcionkę",
                "theme.toggle.aria": "Zmień motyw",
                "disclaimer.text": `<strong>Ważna informacja:</strong> Ta strona jest projektem nieoficjalnym i ma charakter wyłącznie poglądowy. Zawsze sprawdzaj aktualny rozkład jazdy, skład pociągu oraz ewentualne zmiany bezpośrednio na oficjalnej stronie PKP Intercity (<a href="https://www.intercity.pl" target="_blank" rel="noopener noreferrer">www.intercity.pl</a>) lub w innych oficjalnych kanałach przewoźnika przed podróżą. Autorzy strony nie ponoszą odpowiedzialności za ewentualne nieścisłości.`,
                "authenticity.note": `<strong>Gwarancja Autora (stan na 02.04.2025):</strong> Dane dotyczące trasy i podstawowego składu (lokomotywa + typ wagonów) zostały zweryfikowane przez autora strony i są zgodne z najlepszą wiedzą na podany dzień. Mogą jednak wystąpić zmiany operacyjne. Zawsze potwierdzaj szczegóły u przewoźnika.`,
                "button.print": "Drukuj Rozkład",
                "info.composition": "Informacje o składzie",
                "info.rolling_stock": "Typ taboru:",
                "info.max_speed": "Prędkość maksymalna:",
                "info.speed.section": "Prędkość na odcinkach trasy (orientacyjna)",
                "info.speed.disclaimer": "*Prędkości ograniczone możliwościami lokomotywy EP07 i stanem infrastruktury. Mogą się różnić w zależności od warunków.",
                "info.speed.disclaimer.cmk": "*Najwyższe prędkości osiągane na Centralnej Magistrali Kolejowej. Prędkość na odcinku górskim znacznie niższa ze względu na charakterystykę linii.",
                "amenity.ac": "Klimatyzacja (w wybranych wagonach)",
                "amenity.ac.mostly": "Klimatyzacja (w większości wagonów)",
                "amenity.sockets": "Gniazdka elektryczne (dostępność zmienna)",
                "amenity.wifi.rare": "WiFi (rzadko dostępne w tym typie składu)",
                "amenity.wifi.possible": "WiFi (może być dostępne, sprawdź)",
                "amenity.wifi.usually": "WiFi (zazwyczaj dostępne)",
                "amenity.catering.possible": "Możliwy wagon barowy/catering mobilny (sprawdź)",
                "amenity.wars": "Wagon barowy/bistro WARS (sprawdź dostępność)",
                "amenity.classes": "Klasa Biznes, 1 i 2",
                "amenity.reservation": "Obowiązkowa rezerwacja miejsc",
                "table.header.station": "Stacja / Przystanek",
                "table.header.arrival": "Przyjazd",
                "table.header.departure": "Odjazd",
                "table.header.stopover": "Postój",
                "table.header.notes": "Uwagi",
                "table.technical_passage": "Przejazd techniczny",
                "table.passage": "Przejazd",
                "footer.error.prompt": "Znalazłeś błąd lub masz sugestię? Daj nam znać!",
                "footer.error.button": "Zgłoś uwagę",
                "footer.disclaimer.data": "Dane rozkładów jazdy i informacje o składach mają charakter poglądowy i mogą być nieaktualne. Zawsze weryfikuj informacje u źródła.",
                "footer.disclaimer.trademarks": "Znaki towarowe PKP Intercity należą do ich prawnych właścicieli.",
                "footer.link.official_site": "Oficjalna strona PKP Intercity",
                "search.feedback.found": "Znaleziono i wyświetlono pociąg {term}.",
                "search.feedback.not_found": "Nie znaleziono pociągu {term}. Sprawdź numer/nazwę lub wybierz z listy.",
                 // Routes
                 "route.warsaw.swinoujscie": "Warszawa Wschodnia → Świnoujście",
                 "route.warsaw.zakopane": "Warszawa Wschodnia → Zakopane",
                 "route.lodz.gdynia": "Łódź Fabryczna → Gdynia Główna",
                 "route.warsaw.berlin": "Warszawa Wschodnia → Berlin Hbf",
                 "route.gdynia.prague": "Gdynia Główna → Praha hl.n.",
                 // Travel Times
                 "uznam.travel.time": "Czas podróży: ~8h 40min",
                 "galczynski.travel.time": "Czas podróży: ~6h 54min",
                 "tatry.travel.time": "Czas podróży: ~4h 57min",
                 "slowiniec.travel.time": "Czas podróży: ~5h 05min",
                 "ec246.travel.time": "Czas podróży: ~5h 17min",
                 "ec265.travel.time": "Czas podróży: ~9h 09min",
                 // Station Names (shortened for brevity, include all from HTML)
                 "station.warsaw_east": "Warszawa Wschodnia",
                 "station.warsaw_central": "Warszawa Centralna",
                 "station.warsaw_west": "Warszawa Zachodnia",
                 "station.poznan_glowny": "Poznań Główny",
                 "station.swinoujscie": "Świnoujście",
                 "station.szczecin_glowny": "Szczecin Główny",
                 "station.krakow_glowny": "Kraków Główny",
                 "station.zakopane": "Zakopane",
                 "station.lodz_fabryczna": "Łódź Fabryczna",
                 "station.gdynia_glowna": "Gdynia Główna",
                 "station.berlin_hbf": "Berlin Hbf",
                 "station.praha_hlavni": "Praha hl.n.",
                 // ... Include ALL other station keys used in the HTML tables ...
                 "station.sochaczew": "Sochaczew", "station.lowicz_glowny": "Łowicz Główny", "station.kutno": "Kutno", "station.kolo": "Koło", "station.konin": "Konin", "station.slupca": "Słupca", "station.wrzesnia": "Września", "station.swarzedz": "Swarzędz", "station.opalenica": "Opalenica", "station.nowy_tomysl": "Nowy Tomyśl", "station.zbaszyn": "Zbąszyń", "station.zbaszynek": "Zbąszynek", "station.swiebodzin": "Świebodzin", "station.rzepin": "Rzepin", "station.kostrzyn": "Kostrzyn", "station.mieszkowice": "Mieszkowice", "station.chojna": "Chojna", "station.gryfino": "Gryfino", "station.szczecin_dabie": "Szczecin Dąbie", "station.goleniow": "Goleniów", "station.wysoka_kamienska": "Wysoka Kamieńska", "station.miedzyzdroje": "Międzyzdroje", "station.szamotuly": "Szamotuły", "station.wronki": "Wronki", "station.krzyz": "Krzyż", "station.dobiegniew": "Dobiegniew", "station.choszczno": "Choszczno", "station.stargard": "Stargard", "station.idzikowice": "Idzikowice (CMK)", "station.nowy_targ": "Nowy Targ", "station.lodz_widzew": "Łódź Widzew", "station.koluszki": "Koluszki", "station.skierniewice": "Skierniewice", "station.zyrardow": "Żyrardów", "station.legionowo": "Legionowo", "station.nowy_dwor_maz": "Nowy Dwór Mazowiecki", "station.ciechanow": "Ciechanów", "station.mlawa_miasto": "Mława Miasto", "station.dzialdowo": "Działdowo", "station.ilawa_glowna": "Iława Główna", "station.prabuty": "Prabuty", "station.malbork": "Malbork", "station.tczew": "Tczew", "station.gdansk_glowny": "Gdańsk Główny", "station.gdansk_wrzeszcz": "Gdańsk Wrzeszcz", "station.gdansk_oliwa": "Gdańsk Oliwa", "station.sopot": "Sopot", "station.frankfurt_oder_gr": "Frankfurt(Oder)(Gr)", "station.frankfurt_oder": "Frankfurt(Oder)", "station.berlin_ostbahnhof": "Berlin Ostbahnhof", "station.bydgoszcz_glowna": "Bydgoszcz Główna", "station.inowroclaw": "Inowrocław", "station.gniezno": "Gniezno", "station.leszno": "Leszno", "station.wroclaw_glowny": "Wrocław Główny", "station.klodzko_miasto": "Kłodzko Miasto", "station.miedzylesie": "Międzylesie", "station.lichkov": "Lichkov", "station.usti_nad_orlici": "Ústí nad Orlicí", "station.pardubice": "Pardubice hl.n.", "station.kolin": "Kolín",
                 // Notes
                 "notes.start_eic246": "Początek trasy EIC 246",
                 "notes.major_hub": "Główny węzeł przesiadkowy",
                 "notes.swiebodzin_statue": "Figura Chrystusa Króla",
                 "notes.change_to_ec246": "Zmiana numeru na EC 246",
                 "notes.border_pl_de": "Granica państwa PL/DE",
                 "notes.first_stop_de": "Pierwszy postój w Niemczech",
                 "notes.east_side_gallery": "Blisko East Side Gallery",
                 "notes.end_station": "Stacja końcowa",
                 // Languages
                 "lang.pl": "Polski",
                 "lang.en": "English",
                 "lang.de": "Deutsch",
                 "lang.zh": "中文",
                 "lang.ua": "Українська",
                 "lang.ru": "Русский",
                 // Modal
                 "modal.title": "Zgłoś Błąd lub Sugestię",
                 "modal.subject": "Temat:",
                 "modal.description": "Opis Problemu / Sugestia:",
                 "modal.send": "Wyślij Zgłoszenie",
                 "modal.feedback.required": "Proszę wypełnić oba pola.",
                 "modal.feedback.sending": "Wysyłanie...", // Optional
                 "modal.feedback.success": "Zgłoszenie wysłane! Dziękujemy.", // Optional for backend integration
                 "modal.feedback.error": "Wystąpił błąd podczas wysyłania.", // Optional for backend integration
                 // Chatbot Specific (These might need adjustment based on the new KB intents)
                 "chat.toggle.aria": "Otwórz czat pomocy",
                 "chat.header.title": "Pomocnik Rozkładów",
                 "chat.input.placeholder": "Wpisz swoje pytanie...",
                 "chat.send.aria": "Wyślij wiadomość",
                 // --- REMOVED OLD CHATBOT SPECIFIC TRANSLATIONS ---
                 // "chat.greeting": "Cześć! Jestem wirtualnym asystentem. Jak mogę Ci pomóc w nawigacji po stronie z rozkładami?",
                 // "chat.faq.link": "Może znajdziesz odpowiedź w sekcji <a href='#faq'>FAQ</a>?",
                 // "chat.report.link": "Jeśli znalazłeś błąd w rozkładzie, użyj proszę przycisku 'Zgłoś uwagę' w stopce strony.",
                 // "chat.official.link": "Pamiętaj, że to jest strona nieoficjalna. Aktualne i pewne informacje znajdziesz zawsze na <a href='https://www.intercity.pl' target='_blank' rel='noopener noreferrer'>oficjalnej stronie PKP Intercity</a>.",
                 // "chat.fallback": "Przepraszam, nie rozumiem tego pytania. Czy możesz spróbować inaczej je sformułować lub zapytać o coś związanego z tą stroną (np. 'czy dane są aktualne?', 'jak szukać pociągu?')?"
            },
            en: {
                // ... (Copy PL translations and translate to EN) ...
                "header.title": "PKP ICC Timetables",
                "header.subtitle": "Unofficial information service",
                "search.placeholder": "Search train (e.g., 18170 or UZNAM)",
                "search.button.aria": "Search train",
                "fontsize.decrease.aria": "Decrease font size",
                "fontsize.reset.aria": "Reset font size",
                "fontsize.increase.aria": "Increase font size",
                "theme.toggle.aria": "Toggle theme",
                "disclaimer.text": `<strong>Important Information:</strong> This is an unofficial project website and serves informational purposes only. Always check the current timetable, train composition, and any changes directly on the official PKP Intercity website (<a href="https://www.intercity.pl/en/" target="_blank" rel="noopener noreferrer">www.intercity.pl/en/</a>) or through other official channels of the carrier before your journey. The website authors are not responsible for any inaccuracies.`,
                "authenticity.note": `<strong>Author's Guarantee (as of 02.04.2025):</strong> Data regarding the route and basic composition (locomotive + wagon type) has been verified by the site author and is accurate to the best of their knowledge on the specified date. However, operational changes may occur. Always confirm details with the carrier.`,
                "button.print": "Print Timetable",
                "info.composition": "Composition Information",
                "info.rolling_stock": "Rolling Stock:",
                "info.max_speed": "Maximum Speed:",
                "info.speed.section": "Speed on route sections (approximate)",
                "info.speed.disclaimer": "*Speeds limited by EP07 locomotive capabilities and infrastructure condition. May vary depending on conditions.",
                 "info.speed.disclaimer.cmk": "*Highest speeds reached on the Central Rail Line (CMK). Speed on the mountain section is significantly lower due to line characteristics.",
                "amenity.ac": "Air Conditioning (in selected coaches)",
                "amenity.ac.mostly": "Air Conditioning (in most coaches)",
                "amenity.sockets": "Power Sockets (availability varies)",
                "amenity.wifi.rare": "WiFi (rarely available on this type of train)",
                "amenity.wifi.possible": "WiFi (may be available, check)",
                "amenity.wifi.usually": "WiFi (usually available)",
                "amenity.catering.possible": "Dining car/mobile catering possible (check)",
                "amenity.wars": "WARS Dining/Bistro Car (check availability)",
                "amenity.classes": "Business, 1st & 2nd Class",
                "amenity.reservation": "Mandatory seat reservation",
                "table.header.station": "Station / Stop",
                "table.header.arrival": "Arrival",
                "table.header.departure": "Departure",
                "table.header.stopover": "Stopover",
                "table.header.notes": "Notes",
                "table.technical_passage": "Technical passage",
                 "table.passage": "Passage",
                "footer.error.prompt": "Found an error or have a suggestion? Let us know!",
                "footer.error.button": "Report an issue",
                "footer.disclaimer.data": "Timetable data and composition information are indicative and may be outdated. Always verify information at the source.",
                "footer.disclaimer.trademarks": "PKP Intercity trademarks belong to their respective owners.",
                "footer.link.official_site": "Official PKP Intercity website",
                "search.feedback.found": "Found and displayed train {term}.",
                "search.feedback.not_found": "Train {term} not found. Check number/name or select from the list.",
                 // Routes
                 "route.warsaw.swinoujscie": "Warsaw East → Świnoujście",
                 "route.warsaw.zakopane": "Warsaw East → Zakopane",
                 "route.lodz.gdynia": "Łódź Fabryczna → Gdynia Main",
                 "route.warsaw.berlin": "Warsaw East → Berlin Hbf",
                 "route.gdynia.prague": "Gdynia Main → Prague hl.n.",
                 // Travel Times
                 "uznam.travel.time": "Travel time: ~8h 40min",
                 "galczynski.travel.time": "Travel time: ~6h 54min",
                 "tatry.travel.time": "Travel time: ~4h 57min",
                 "slowiniec.travel.time": "Travel time: ~5h 05min",
                 "ec246.travel.time": "Travel time: ~5h 17min",
                 "ec265.travel.time": "Travel time: ~9h 09min",
                // Station Names (Translate all relevant keys)
                 "station.warsaw_east": "Warsaw East",
                 "station.warsaw_central": "Warsaw Central",
                 "station.warsaw_west": "Warsaw West",
                 "station.poznan_glowny": "Poznań Main",
                 "station.swinoujscie": "Świnoujście",
                 "station.krakow_glowny": "Krakow Main",
                 "station.zakopane": "Zakopane",
                 "station.lodz_fabryczna": "Łódź Fabryczna",
                 "station.gdansk_glowny": "Gdańsk Main",
                 "station.gdynia_glowna": "Gdynia Main",
                 "station.frankfurt_oder": "Frankfurt(Oder)",
                 "station.berlin_ostbahnhof": "Berlin East Station",
                 "station.berlin_hbf": "Berlin Central Station (Hbf)",
                 "station.wroclaw_glowny": "Wrocław Main",
                 "station.praha_hlavni": "Prague Main Station (hl.n.)",
                  // ... Translate ALL other station keys ...
                 "station.sochaczew": "Sochaczew", "station.lowicz_glowny": "Łowicz Główny", "station.kutno": "Kutno", "station.kolo": "Koło", "station.konin": "Konin", "station.slupca": "Słupca", "station.wrzesnia": "Września", "station.swarzedz": "Swarzędz", "station.opalenica": "Opalenica", "station.nowy_tomysl": "Nowy Tomyśl", "station.zbaszyn": "Zbąszyń", "station.zbaszynek": "Zbąszynek", "station.swiebodzin": "Świebodzin", "station.rzepin": "Rzepin", "station.kostrzyn": "Kostrzyn", "station.mieszkowice": "Mieszkowice", "station.chojna": "Chojna", "station.gryfino": "Gryfino", "station.szczecin_glowny": "Szczecin Główny", "station.szczecin_dabie": "Szczecin Dąbie", "station.goleniow": "Goleniów", "station.wysoka_kamienska": "Wysoka Kamieńska", "station.miedzyzdroje": "Międzyzdroje", "station.szamotuly": "Szamotuły", "station.wronki": "Wronki", "station.krzyz": "Krzyż", "station.dobiegniew": "Dobiegniew", "station.choszczno": "Choszczno", "station.stargard": "Stargard", "station.idzikowice": "Idzikowice (CMK)", "station.nowy_targ": "Nowy Targ", "station.lodz_widzew": "Łódź Widzew", "station.koluszki": "Koluszki", "station.skierniewice": "Skierniewice", "station.zyrardow": "Żyrardów", "station.legionowo": "Legionowo", "station.nowy_dwor_maz": "Nowy Dwór Mazowiecki", "station.ciechanow": "Ciechanów", "station.mlawa_miasto": "Mława Miasto", "station.dzialdowo": "Działdowo", "station.ilawa_glowna": "Iława Główna", "station.prabuty": "Prabuty", "station.malbork": "Malbork", "station.tczew": "Tczew", "station.gdansk_wrzeszcz": "Gdańsk Wrzeszcz", "station.gdansk_oliwa": "Gdańsk Oliwa", "station.sopot": "Sopot", "station.frankfurt_oder_gr": "Frankfurt(Oder)(Gr)", "station.berlin_ostbahnhof": "Berlin Ostbahnhof", "station.bydgoszcz_glowna": "Bydgoszcz Główna", "station.inowroclaw": "Inowrocław", "station.gniezno": "Gniezno", "station.leszno": "Leszno", "station.klodzko_miasto": "Kłodzko Miasto", "station.miedzylesie": "Międzylesie", "station.lichkov": "Lichkov", "station.usti_nad_orlici": "Ústí nad Orlicí", "station.pardubice": "Pardubice hl.n.", "station.kolin": "Kolín",
                 // Notes
                 "notes.start_eic246": "Start of route EIC 246",
                 "notes.major_hub": "Major interchange hub",
                 "notes.swiebodzin_statue": "Christ the King statue nearby",
                 "notes.change_to_ec246": "Train number changes to EC 246",
                 "notes.border_pl_de": "PL/DE State border",
                 "notes.first_stop_de": "First stop in Germany",
                 "notes.east_side_gallery": "Near East Side Gallery",
                 "notes.end_station": "Terminus station",
                 // Languages
                 "lang.pl": "Polski",
                 "lang.en": "English",
                 "lang.de": "Deutsch",
                 "lang.zh": "中文",
                 "lang.ua": "Українська",
                 "lang.ru": "Русский",
                 // Modal
                 "modal.title": "Report Error or Suggestion",
                 "modal.subject": "Subject:",
                 "modal.description": "Problem Description / Suggestion:",
                 "modal.send": "Send Report",
                 "modal.feedback.required": "Please fill in both fields.",
                 "modal.feedback.sending": "Sending...",
                 "modal.feedback.success": "Report sent! Thank you.",
                 "modal.feedback.error": "An error occurred while sending.",
                 // Chatbot Specific (These might need adjustment based on the new KB intents)
                 "chat.toggle.aria": "Open help chat",
                 "chat.header.title": "Timetable Helper",
                 "chat.input.placeholder": "Type your question...",
                 "chat.send.aria": "Send message",
                 // --- REMOVED OLD CHATBOT SPECIFIC TRANSLATIONS ---
                 // "chat.greeting": "Hi! I'm a virtual assistant. How can I help you navigate this timetable site?",
                 // "chat.faq.link": "Maybe you'll find the answer in the <a href='#faq'>FAQ</a> section?",
                 // "chat.report.link": "If you found an error in the timetable, please use the 'Report an issue' button in the footer.",
                 // "chat.official.link": "Remember, this is an unofficial site. Always find current and reliable information on the <a href='https://www.intercity.pl/en/' target='_blank' rel='noopener noreferrer'>official PKP Intercity website</a>.",
                 // "chat.fallback": "Sorry, I don't understand that question. Could you try rephrasing it or asking something related to this website (e.g., 'is the data current?', 'how to search for a train?')?",

            },
            // DE, ZH, UA, RU translations would follow the same pattern
             de: { /* Add German translations here */ },
             zh: { /* Add Chinese translations here */ },
             ua: { /* Add Ukrainian translations here */ },
             ru: { /* Add Russian translations here */ },
        };

        // --- State ---
        let currentFontSize = 16; // Default in px
        let currentLang = 'pl'; // Default language
        let isChatOpen = false;
        let chatBotTypingTimeout = null; // KEEP for typing indicator


        // --- Dynamic Date, Time, and Year ---
        function updateDateTime() {
            const now = new Date();
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };

            try {
                const locale = currentLang === 'zh' ? 'zh-CN' : currentLang === 'ua' ? 'uk-UA' : currentLang;
                timeElement.textContent = now.toLocaleTimeString(locale, timeOptions);
                dateElement.textContent = now.toLocaleDateString(locale, dateOptions);
            } catch (e) {
                console.warn("Locale options might not be fully supported for:", currentLang, e);
                timeElement.textContent = now.toLocaleTimeString('pl-PL', timeOptions);
                dateElement.textContent = now.toLocaleDateString('pl-PL', dateOptions);
            }
        }
        yearElement.textContent = new Date().getFullYear();


        // --- Theme Switcher ---
        // ... (Theme functions remain the same) ...
        function applyTheme(theme) {
            const icon = themeToggleButton.querySelector('i');
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-mode');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('theme', 'light');
            }
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
            applyTheme(savedTheme ? savedTheme : (prefersDarkScheme.matches ? 'dark' : 'light'));

            themeToggleButton.addEventListener('click', () => {
                const newTheme = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
                applyTheme(newTheme);
            });

            prefersDarkScheme.addEventListener('change', (e) => {
                 if (!localStorage.getItem('theme')) {
                     applyTheme(e.matches ? 'dark' : 'light');
                 }
             });
        }


        // --- Font Size Adjustment ---
        // ... (Font size functions remain the same) ...
        function adjustFontSize(change) {
            const currentSize = parseFloat(getComputedStyle(htmlElement).fontSize);
            let newSize = currentSize + change;
            newSize = Math.max(12, Math.min(24, newSize)); // Clamp between 12px and 24px
            htmlElement.style.fontSize = `${newSize}px`;
            localStorage.setItem('fontSize', newSize);
        }

        function resetFontSize() {
             // Reset to the value defined in CSS variable --base-font-size
             htmlElement.style.fontSize = `var(--base-font-size)`;
             localStorage.removeItem('fontSize');
        }

        function initializeFontSize() {
             const savedSize = localStorage.getItem('fontSize');
             if (savedSize) {
                 // Apply saved size, but ensure it's within bounds on load
                 const sizePx = Math.max(12, Math.min(24, parseFloat(savedSize)));
                 htmlElement.style.fontSize = `${sizePx}px`;
             } else {
                 htmlElement.style.fontSize = `var(--base-font-size)`;
             }

             increaseFontButton.addEventListener('click', () => adjustFontSize(1));
             decreaseFontButton.addEventListener('click', () => adjustFontSize(-1));
             resetFontButton.addEventListener('click', resetFontSize);
        }


        // --- Language Switching (UPDATED for Chatbot - uses NEW response getter) ---
        function setLanguage(lang) {
            if (!translations[lang]) {
                console.warn(`Language ${lang} not found, defaulting to pl.`);
                lang = 'pl';
            }
             const previousLang = currentLang;
            currentLang = lang;
            htmlElement.lang = lang;

            // Update displayed flag
            currentLangFlag.src = flagSources[lang] || ''; // Use stored source
            currentLangFlag.alt = `Flag for ${lang}`;

            const elementsToTranslate = document.querySelectorAll('[data-translate-key]');
            elementsToTranslate.forEach(el => {
                const key = el.dataset.translateKey;
                const translationSet = translations[lang] || translations['pl'];
                const fallbackSet = translations['pl'];
                let translation = `[${key}]`; // Default

                if (translationSet && translationSet[key]) {
                    translation = translationSet[key];
                } else if (fallbackSet && fallbackSet[key]) {
                    translation = fallbackSet[key];
                } else {
                    // Only warn if it's NOT an old chatbot key we removed intentionally
                    if(!key.startsWith('chat.')) {
                        console.warn(`Translation key "${key}" not found for lang "${lang}" or fallback "pl".`);
                    }
                }

                // Handle element types / attributes (same logic as before)
                if (el.tagName === 'INPUT' && el.type === 'search' && key === 'search.placeholder') {
                    el.placeholder = translation;
                } else if (el.tagName === 'INPUT' && el.id === 'chat-input' && key === 'chat.input.placeholder') {
                    el.placeholder = translation; // Translate chat input placeholder
                } else if (el.tagName === 'LABEL' && key.startsWith('modal.')) {
                    el.textContent = translation;
                } else if (el.hasAttribute('aria-label') && key.endsWith('.aria')) {
                    el.setAttribute('aria-label', translation);
                } else if (key === 'disclaimer.text' || key === 'authenticity.note') {
                    el.innerHTML = translation;
                } else if (el.tagName === 'BUTTON' && el.classList.contains('lang-option')) {
                     const span = el.querySelector('span');
                     if (span && key.startsWith('lang.')) { span.textContent = translation; }
                } else if (el.id === 'chat-header-title' && key === 'chat.header.title') {
                     // Find the span inside the chat header to translate
                     const span = el.querySelector('span');
                     if (span) span.textContent = ` ${translation}`; // Add space
                } else {
                     // Skip old chat keys we no longer translate directly
                    if (key.startsWith('chat.')) return;

                     if (!el.querySelector('i') && !el.querySelector('img')) {
                        el.textContent = translation;
                    } else {
                        let textNode = Array.from(el.childNodes).find(node => node.nodeType === Node.TEXT_NODE && node.textContent.trim().length > 0);
                        if (textNode) {
                            textNode.textContent = ` ${translation}`; // Add potential leading space
                        } else {
                             // Specific fallbacks if needed
                             if (key === 'header.title') {
                                 let textNodeH1 = Array.from(el.childNodes).find(node => node.nodeType === Node.TEXT_NODE && node.textContent.trim().length > 0);
                                 if(textNodeH1) textNodeH1.textContent = ` ${translation}`;
                             } else {
                                 // Last resort - might overwrite icons in rare cases
                                 // Check if it's a button text without icon explicitly
                                 if(el.tagName === 'BUTTON' && !el.querySelector('i')){
                                     el.textContent = translation;
                                 }
                                 // console.warn("Complex element translation check:", key, el);
                             }
                        }
                    }
                }
            });

             // If chat is open and language changed, resend greeting in new lang using NEW KB
             if (isChatOpen && previousLang !== currentLang) {
                  // Add small delay to ensure UI updates then send greeting
                  setTimeout(() => {
                       addChatMessage(getChatbotResponse_new("intent_greeting"), 'bot');
                  }, 100);
             }

            // Store preference
            localStorage.setItem('language', lang);

            // Update date/time display
            updateDateTime();
        }

        function initializeLanguage() {
            const savedLang = localStorage.getItem('language') || 'pl';
            setLanguage(savedLang); // Set initial language and flag

            langOptionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    setLanguage(button.dataset.lang);
                    // Hide dropdown after selection
                     if (document.activeElement instanceof HTMLElement) {
                        document.activeElement.blur(); // Remove focus to allow CSS hover logic to hide
                     }
                     // Ensure focus is managed if needed
                     // currentLangDisplay.focus(); // Or move focus elsewhere
                });
            });

            // Accessibility for language selector dropdown
            currentLangDisplay.addEventListener('keydown', (e) => {
                 if (e.key === 'Enter' || e.key === ' ') {
                     e.preventDefault(); // Prevent page scroll
                     // Toggle visibility manually if hover isn't sufficient
                     languageOptionsContainer.style.display = languageOptionsContainer.style.display === 'flex' ? 'none' : 'flex';
                     // Optionally focus the first item
                     if (languageOptionsContainer.style.display === 'flex') {
                         langOptionButtons[0]?.focus();
                     }
                 }
             });
             // Allow Esc to close dropdown
             languageOptionsContainer.addEventListener('keydown', (e) => {
                 if (e.key === 'Escape') {
                     languageOptionsContainer.style.display = 'none';
                     currentLangDisplay.focus(); // Return focus
                 }
             });
        }


        // --- Train Content Switcher ---
        // ... (activateTrain function remains the same) ...
        function activateTrain(buttonId) {
             let found = false;
             selectorButtons.forEach(btn => {
                 if (btn.id === buttonId) {
                     btn.classList.add('active');
                     found = true;
                 } else {
                     btn.classList.remove('active');
                 }
             });

             trainContents.forEach(content => {
                 const expectedContentId = buttonId.replace(/^select-/, '') + '-content';
                 content.classList.toggle('active', content.id === expectedContentId);
             });
             return found;
        }


        function initializeTrainSwitcher() {
            selectorButtons.forEach(button => {
                button.addEventListener('click', () => {
                    activateTrain(button.id);
                    searchFeedback.style.display = 'none';
                    searchInput.value = '';
                     // Update URL hash
                     const trainName = button.dataset.trainName || button.id.replace('select-','');
                     window.location.hash = trainName; // Update hash to reflect selection
                });
            });

             // Activate based on URL hash if present, otherwise default
             const hash = window.location.hash.substring(1); // Get #train-name
             let activatedFromHash = false;
             if (hash && document.getElementById(`select-${hash}`)) {
                 activatedFromHash = activateTrain(`select-${hash}`);
             } else { // Try matching hash against train numbers or names in data attributes
                 let foundButtonIdByHashData = null;
                 for (const btn of selectorButtons) {
                     if (btn.dataset.trainNumber === hash || (btn.dataset.trainName && btn.dataset.trainName.toLowerCase() === hash.toLowerCase())) {
                         foundButtonIdByHashData = btn.id;
                         break;
                     }
                 }
                 if (foundButtonIdByHashData) {
                     activatedFromHash = activateTrain(foundButtonIdByHashData);
                 }
             }


            if (!activatedFromHash) {
                const initiallyActiveButton = document.querySelector('.train-selector button.active');
                 if (initiallyActiveButton) {
                    activateTrain(initiallyActiveButton.id);
                     const initialTrainName = initiallyActiveButton.dataset.trainName || initiallyActiveButton.id.replace('select-','');
                     window.location.hash = initialTrainName; // Set hash for initial active
                } else if (selectorButtons.length > 0) {
                    activateTrain(selectorButtons[0].id);
                    const firstTrainName = selectorButtons[0].dataset.trainName || selectorButtons[0].id.replace('select-','');
                     window.location.hash = firstTrainName; // Set hash for first button
                }
            }
        }


        // --- Search Functionality ---
        // ... (performSearch function remains the same - relies on activateTrain) ...
         function performSearch() {
            const searchTermRaw = searchInput.value.trim();
            searchFeedback.style.display = 'none';

            if (!searchTermRaw) return;

            const searchTermLower = searchTermRaw.toLowerCase();
            let foundButtonId = null;

            // Prioritize number match
            if (trainDataMap[searchTermRaw]) {
                foundButtonId = trainDataMap[searchTermRaw];
            }
            // Then exact name match (case insensitive)
            else if (trainNameMap[searchTermLower]) {
                foundButtonId = trainNameMap[searchTermLower];
            }
             // Then partial name match
            else {
                // Find the best partial match (e.g., longest common substring or simple includes)
                let bestMatchId = null;
                let maxMatchLength = 0;

                 for (const nameKey in trainNameMap) {
                     if (nameKey.includes(searchTermLower)) {
                         if (nameKey.length > maxMatchLength) { // Prefer longer matches if multiple contain the term
                             maxMatchLength = nameKey.length;
                             bestMatchId = trainNameMap[nameKey];
                         } else if (!bestMatchId) { // Take the first found if lengths are equal or not tracked
                             bestMatchId = trainNameMap[nameKey];
                         }
                     }
                 }
                 foundButtonId = bestMatchId; // Assign the best found partial match
            }

            if (foundButtonId) {
                const success = activateTrain(foundButtonId);
                if (success) {
                    const feedbackText = (translations[currentLang]['search.feedback.found'] || translations['pl']['search.feedback.found']).replace('{term}', searchTermRaw);
                    searchFeedback.textContent = feedbackText;
                    searchFeedback.className = 'success';
                    searchFeedback.style.display = 'block';
                    const targetButton = document.getElementById(foundButtonId);
                    if (targetButton) {
                         // Update URL hash
                         const trainName = targetButton.dataset.trainName || foundButtonId.replace('select-','');
                         window.location.hash = trainName; // Update hash to reflect selection
                        targetButton.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    } else {
                        console.warn("Target button for scrolling not found:", foundButtonId);
                    }
                } else {
                     console.error("Activation failed for found button ID:", foundButtonId);
                     const feedbackText = (translations[currentLang]['search.feedback.not_found'] || translations['pl']['search.feedback.not_found']).replace('{term}', searchTermRaw);
                     searchFeedback.textContent = feedbackText;
                     searchFeedback.className = 'error';
                     searchFeedback.style.display = 'block';
                }

            } else {
                const feedbackText = (translations[currentLang]['search.feedback.not_found'] || translations['pl']['search.feedback.not_found']).replace('{term}', searchTermRaw);
                searchFeedback.textContent = feedbackText;
                searchFeedback.className = 'error';
                searchFeedback.style.display = 'block';
            }
        }


        function initializeSearch() {
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    performSearch();
                }
            });
            searchInput.addEventListener('input', () => {
                 searchFeedback.style.display = 'none';
            });
        }


        // --- Print Functionality ---
        // ... (initializePrint function remains the same) ...
         function initializePrint() {
            printButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const trainContent = button.closest('.train-content');
                    if (trainContent && trainContent.classList.contains('active')) {
                        // Ensure only the active content is marked for print
                        document.querySelectorAll('.train-content.active-for-print').forEach(el => el.classList.remove('active-for-print'));
                        trainContent.classList.add('active-for-print');
                        window.print();
                         // Use setTimeout for wider compatibility than requestAnimationFrame after print dialog
                        setTimeout(() => {
                           trainContent.classList.remove('active-for-print');
                        }, 500); // Delay allows print dialog to close
                    } else if (trainContent) {
                         console.log("Attempted to print non-active train content.");
                     }
                });
            });
        }


        // --- Error Reporting Modal Functionality ---
        // ... (Modal functions remain the same) ...
         function showModal() {
            modalFeedback.style.display = 'none'; // Clear old feedback
            errorReportModal.classList.add('active');
            reportSubjectInput.focus(); // Focus first field
         }

         function hideModal() {
             errorReportModal.classList.remove('active');
             // Optionally clear form fields on close
             // reportSubjectInput.value = '';
             // reportDescriptionInput.value = '';
         }

         function handleModalSubmit(event) {
             event.preventDefault(); // Prevent default form submission
             const subject = reportSubjectInput.value.trim();
             const description = reportDescriptionInput.value.trim();
             const feedbackRequiredKey = 'modal.feedback.required';
             const feedbackRequiredText = translations[currentLang][feedbackRequiredKey] || translations['pl'][feedbackRequiredKey];


             if (!subject || !description) {
                 modalFeedback.textContent = feedbackRequiredText;
                 modalFeedback.style.display = 'block';
                 return;
             }

             modalFeedback.style.display = 'none';

             // Construct mailto link
             const recipient = "lukasz9087654321@gmail.com"; // MAKE SURE THIS IS CORRECT
             const mailtoSubject = encodeURIComponent(`[Rozklady PKP Strona] ${subject}`);
             const mailtoBody = encodeURIComponent(`Opis problemu / Sugestia:\n---------------------------\n${description}\n\n(Prosimy nie usuwać tematu emaila)`);

             const mailtoLink = `mailto:${recipient}?subject=${mailtoSubject}&body=${mailtoBody}`;

             // Attempt to open mail client
             // Use window.open for potentially better compatibility / less blocking behavior
             const mailWindow = window.open(mailtoLink, '_blank');
             if (!mailWindow) {
                  // Fallback if pop-up blocker prevents opening mail client directly
                  console.warn("Could not open mail client directly. Providing link.");
                  modalFeedback.innerHTML = `Nie można otworzyć klienta poczty. Użyj tego linku: <a href="${mailtoLink}" target="_blank">Wyślij email</a>`;
                  modalFeedback.style.color = 'var(--info-color)'; // Use info color for this message
                  modalFeedback.style.display = 'block';
             } else {
                // Close the modal after a short delay if mailto likely worked
                setTimeout(hideModal, 500);
             }
         }

         function initializeModal() {
             openReportModalButton.addEventListener('click', showModal);
             modalCloseButton.addEventListener('click', hideModal);
             errorReportModal.addEventListener('click', (event) => {
                 // Close if clicked on the overlay background, not the content
                 if (event.target === errorReportModal) {
                     hideModal();
                 }
             });
             errorReportForm.addEventListener('submit', handleModalSubmit);
         }

        // ============================================== //
        // === START: NEW IMPROVED CHATBOT CODE ========= //
        // ============================================== //

        // --- Stop Words (Add more as needed) ---
        const stopWords_en = new Set(['i', 'me', 'my', 'myself', 'we', 'our', 'ours', 'ourselves', 'you', 'your', 'yours', 'yourself', 'yourselves', 'he', 'him', 'his', 'himself', 'she', 'her', 'hers', 'herself', 'it', 'its', 'itself', 'they', 'them', 'their', 'theirs', 'themselves', 'what', 'which', 'who', 'whom', 'this', 'that', 'these', 'those', 'am', 'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had', 'having', 'do', 'does', 'did', 'doing', 'a', 'an', 'the', 'and', 'but', 'if', 'or', 'because', 'as', 'until', 'while', 'of', 'at', 'by', 'for', 'with', 'about', 'against', 'between', 'into', 'through', 'during', 'before', 'after', 'above', 'below', 'to', 'from', 'up', 'down', 'in', 'out', 'on', 'off', 'over', 'under', 'again', 'further', 'then', 'once', 'here', 'there', 'when', 'where', 'why', 'how', 'all', 'any', 'both', 'each', 'few', 'more', 'most', 'other', 'some', 'such', 'no', 'nor', 'not', 'only', 'own', 'same', 'so', 'than', 'too', 'very', 's', 't', 'can', 'will', 'just', 'don', 'should', 'now', 'please', 'tell', 'me', 'about', 'can', 'you', 'whats', 'what\'s']);
        const stopWords_pl = new Set(['ach', 'aj', 'albo', 'bardzo', 'bez', 'bo', 'by', 'byli', 'bylo', 'bym', 'bys', 'byc', 'bedzie', 'beda', 'byl', 'byla', 'byly', 'ci', 'cie', 'ciebie', 'co', 'czy', 'czyli', 'daleko', 'dla', 'dlaczego', 'do', 'dobrze', 'dokad', 'dosc', 'duzo', 'dwa', 'dwie', 'dwoje', 'dzis', 'dzisiaj', 'gdy', 'gdzie', 'go', 'i', 'ich', 'ile', 'im', 'inny', 'ja', 'jak', 'jakas', 'jaki', 'jakis', 'jakos', 'ja', 'je', 'jeden', 'jedna', 'jedno', 'jego', 'jej', 'jemu', 'jest', 'jestem', 'jeszcze', 'jesli', 'jezeli', 'juz', 'kazdy', 'kiedy', 'kierunku', 'kto', 'ktora', 'ktore', 'ktorego', 'ktorej', 'ktoremu', 'ktory', 'ktorych', 'ktorym', 'ktorymi', 'ktos', 'ku', 'lat', 'lecz', 'lub', 'ma', 'mają', 'mam', 'mi', 'miedzy', 'mimo', 'mnie', 'moga', 'moi', 'moim', 'moj', 'moja', 'moje', 'moze', 'mozliwe', 'mozna', 'mu', 'musi', 'my', 'na', 'nad', 'nam', 'nami', 'nas', 'nasi', 'nasz', 'nasza', 'nasze', 'natychmiast', 'nia', 'nic', 'nich', 'nie', 'niego', 'niej', 'niemu', 'nigdy', 'nim', 'nimi', 'niz', 'no', 'o', 'obok', 'od', 'ok', 'on', 'ona', 'one', 'oni', 'ono', 'owszem', 'pan', 'po', 'pod', 'ponad', 'poniewaz', 'poza', 'prawie', 'przeciez', 'przed', 'przede', 'przedtem', 'przez', 'przy', 'raz', 'roku', 'rowniez', 'sam', 'sama', 'sie', 'skad', 'soba', 'sobie', 'sposob', 'swoje', 'ta', 'tak', 'taki', 'takie', 'takze', 'tam', 'te', 'tego', 'tej', 'temu', 'ten', 'teraz', 'tez', 'to', 'toba', 'tobie', 'trzy', 'twoi', 'twoim', 'twoj', 'twoja', 'twoje', 'ty', 'tych', 'tylko', 'tym', 'u', 'w', 'wam', 'wami', 'was', 'wasi', 'wasz', 'wasza', 'wasze', 'we', 'wedlug', 'wiec', 'wiele', 'wielu', 'wlasnie', 'wszyscy', 'wszystkich', 'wszystkim', 'wszystko', 'wtedy', 'wy', 'z', 'za', 'zaden', 'zadna', 'zadne', 'zawsze', 'ze', 'zeby', 'zl', 'znow', 'znad', 'zostal', 'zostala', 'zostalo', 'zostaly', 'cię', 'ę', 'ą', 'ś', 'ć', 'ń', 'ó', 'ł', 'ż', 'ź', 'powiedzieć', 'proszę', 'jaka', 'jakiś', 'jesteś']);

        // --- NEW Intent-Based Chatbot Knowledge Base (KB) ---
        const chatKB_new = {
            'intent_greeting': {
                keywords_en: ['hello', 'hi', 'hey', 'good morning', 'good afternoon', 'greetings'],
                keywords_pl: ['cześć', 'hej', 'witaj', 'dzień dobry', 'witam'],
                priority: 1,
                responses: {
                    pl: "Cześć! Jestem Twoim wirtualnym asystentem ds. rozkładów. W czym mogę dziś pomóc?",
                    en: "Hello! I'm your virtual timetable assistant. How can I help you today?"
                }
            },
            'intent_thank_you': {
                keywords_en: ['thank you', 'thanks', 'great', 'ok', 'cool', 'appreciated'],
                keywords_pl: ['dziękuję', 'dzięki', 'super', 'świetnie', 'doceniam'],
                priority: 1,
                responses: {
                    pl: "Proszę bardzo! Jeśli masz jeszcze jakieś pytania, śmiało pytaj.",
                    en: "You're welcome! Feel free to ask if you have any more questions."
                }
            },
            'intent_help': {
                keywords_en: ['help', 'assist', 'what can you do', 'capabilities', 'info'],
                keywords_pl: ['pomoc', 'pomóż', 'co potrafisz', 'co umiesz', 'możliwości', 'info', 'informacje'],
                priority: 5, // High priority to catch general help requests
                responses: {
                    pl: "Potrafię odpowiadać na pytania dotyczące tej strony: jak wyszukiwać pociągi, zmieniać motyw/język/czcionkę, drukować rozkłady, zgłaszać błędy. Mogę też udzielić ogólnych informacji o typach pociągów (np. prędkość, WiFi, catering), aktualności danych i celu tej strony. Pamiętaj, że po szczegółowe i zawsze aktualne informacje udaj się na stronę PKP Intercity.",
                    en: "I can answer questions about this site: how to search for trains, change the theme/language/font, print timetables, report errors. I can also provide general information about train types (e.g., speed, WiFi, catering), data accuracy, and the purpose of this site. Remember, for detailed and always up-to-date information, please visit the official PKP Intercity website."
                }
            },
            'intent_site_official': {
                keywords_en: ['official', 'pkp', 'intercity', 'real site', 'affiliated'],
                keywords_pl: ['oficjalna', 'oficjalny', 'pkp', 'intercity', 'prawdziwa strona', 'powiązany'],
                priority: 8,
                responses: {
                    pl: "Nie, to jest <strong>nieoficjalna</strong> strona stworzona jako projekt hobbystyczny i poglądowy. Nie jest powiązana z PKP Intercity. Zawsze sprawdzaj dane na oficjalnej stronie: <a href='https://www.intercity.pl' target='_blank' rel='noopener noreferrer'>www.intercity.pl</a>.",
                    en: "No, this is an <strong>unofficial</strong> site created as a hobby and demonstration project. It is not affiliated with PKP Intercity. Always check data on the official website: <a href='https://www.intercity.pl/en/' target='_blank' rel='noopener noreferrer'>www.intercity.pl/en/</a>."
                }
            },
            'intent_site_purpose': {
                keywords_en: ['purpose', 'goal', 'why this site', 'objective'],
                keywords_pl: ['cel', 'po co', 'dlaczego ta strona', 'zadanie'],
                priority: 3,
                responses: {
                    pl: "Celem tej strony jest prezentacja przykładowych rozkładów jazdy i informacji o pociągach PKP Intercity w przejrzysty sposób, głównie w celach demonstracyjnych i informacyjnych.",
                    en: "The purpose of this site is to present example PKP Intercity train timetables and information in a clear format, mainly for demonstration and informational purposes."
                }
            },
            'intent_data_accuracy': {
                keywords_en: ['accurate', 'up to date', 'current', 'reliable', 'valid', 'correct data', 'timetable current'],
                keywords_pl: ['aktualne', 'dokładne', 'prawidłowe', 'poprawne dane', 'ważny rozkład', 'aktualność', 'wiarygodne'],
                priority: 9, // Very important intent
                responses: {
                    pl: "Dane na tej stronie są <strong>poglądowe</strong> i mogą nie być w 100% aktualne. Chociaż staram się weryfikować podstawowe informacje (patrz 'Gwarancja Autora'), zawsze mogą wystąpić zmiany operacyjne. Dla pewności, sprawdzaj rozkład na <a href='https://www.intercity.pl' target='_blank' rel='noopener noreferrer'>oficjalnej stronie PKP Intercity</a> przed podróżą.",
                    en: "The data on this site is <strong>indicative</strong> and may not be 100% up-to-date. Although basic information is verified (see 'Author's Guarantee'), operational changes can always occur. To be sure, check the timetable on the <a href='https://www.intercity.pl/en/' target='_blank' rel='noopener noreferrer'>official PKP Intercity website</a> before your journey."
                }
            },
             'intent_data_update_frequency': {
                keywords_en: ['how often updated', 'update frequency', 'when updated'],
                keywords_pl: ['jak często aktualizowane', 'częstotliwość aktualizacji', 'kiedy aktualizacja'],
                priority: 4,
                responses: {
                    pl: "Aktualizacje na tej nieoficjalnej stronie nie są regularne i zależą od dostępności danych i czasu autora. Traktuj prezentowane informacje jako migawkę stanu z określonego dnia (sprawdź 'Gwarancję Autora').",
                    en: "Updates on this unofficial site are not regular and depend on data availability and the author's time. Treat the presented information as a snapshot from a specific date (check the 'Author's Guarantee')."
                }
            },
             'intent_author_guarantee': {
                keywords_en: ['author guarantee', 'what guarantee', 'verification date'],
                keywords_pl: ['gwarancja autora', 'co to gwarancja', 'data weryfikacji'],
                priority: 6,
                responses: {
                    pl: "Sekcja 'Gwarancja Autora' przy rozkładzie informuje, kiedy autor strony ostatni raz zweryfikował podstawowe dane (trasę, typ składu) dla danego pociągu. Nie jest to oficjalna gwarancja przewoźnika i nie obejmuje zmian operacyjnych.",
                    en: "The 'Author's Guarantee' section next to the timetable indicates when the site author last verified the basic data (route, train type) for that train. It is not an official guarantee from the carrier and doesn't cover operational changes."
                }
            },
            'intent_search_help': {
                keywords_en: ['search', 'find train', 'look up', 'how search'],
                keywords_pl: ['szukaj', 'wyszukaj', 'znajdź pociąg', 'jak szukać', 'wyszukiwanie'],
                priority: 7,
                responses: {
                    pl: "Aby wyszukać pociąg, wpisz jego numer (np. '18170') lub nazwę (np. 'UZNAM') w polu wyszukiwania na górze strony i naciśnij Enter lub kliknij ikonę lupy <i class='fas fa-search'></i>.",
                    en: "To search for a train, enter its number (e.g., '18170') or name (e.g., 'UZNAM') in the search box at the top of the page and press Enter or click the magnifying glass icon <i class='fas fa-search'></i>."
                }
            },
            'intent_switch_train': {
                keywords_en: ['switch train', 'change train', 'select train', 'view other', 'show different'],
                keywords_pl: ['zmień pociąg', 'przełącz pociąg', 'wybierz pociąg', 'pokaż inny', 'zobacz inny'],
                priority: 6,
                responses: {
                    pl: "Aby zobaczyć rozkład innego pociągu, kliknij jeden z przycisków z jego nazwą i numerem (np. '<i class=\"fas fa-train\"></i> IC 1856 GAŁCZYŃSKI'), które znajdują się pod żółtym polem informacyjnym.",
                    en: "To see the timetable for a different train, click one of the buttons with its name and number (e.g., '<i class=\"fas fa-train\"></i> IC 1856 GAŁCZYŃSKI'), located below the yellow information box."
                }
            },
             'intent_change_language': {
                keywords_en: ['change language', 'switch language', 'translation', 'speak english', 'deutsch'],
                keywords_pl: ['zmień język', 'przełącz język', 'tłumaczenie', 'po angielsku', 'niemiecki'],
                priority: 5,
                responses: {
                    pl: "Język strony możesz zmienić, klikając na ikonę flagi <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAYAAAB24g05AAAAPElEQVQokWNgwA78//8/AyUYQBFgACQyMDEyMrgAKTIwsjAwgKLiAaQyhNQJgAKD5AACg2chIMPAAICpACPaAeQMAAAAAElFTkSuQmCC\" alt=\"PL\" style=\"width:16px; vertical-align:middle;\"> w prawym górnym rogu ekranu i wybierając preferowany język z listy.",
                    en: "You can change the site language by clicking the flag icon <img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAALCAYAAAB24g05AAAAPElEQVQokWNgwA78//8/AyUYQBFgACQyMDEyMrgAKTIwsjAwgKLiAaQyhNQJgAKD5AACg2chIMPAAICpACPaAeQMAAAAAElFTkSuQmCC\" alt=\"PL\" style=\"width:16px; vertical-align:middle;\"> in the top right corner of the screen and selecting your preferred language from the list."
                }
            },
             'intent_change_theme': {
                keywords_en: ['change theme', 'dark mode', 'light mode', 'background color', 'appearance'],
                keywords_pl: ['zmień motyw', 'ciemny tryb', 'jasny tryb', 'kolor tła', 'wygląd'],
                priority: 5,
                responses: {
                    pl: "Aby przełączyć motyw strony między jasnym a ciemnym, kliknij ikonę słońca <i class='fas fa-sun'></i> lub księżyca <i class='fas fa-moon'></i> w prawym górnym rogu.",
                    en: "To switch the site theme between light and dark, click the sun <i class='fas fa-sun'></i> or moon <i class='fas fa-moon'></i> icon in the top right corner."
                }
            },
             'intent_font_size': {
                keywords_en: ['font size', 'text size', 'bigger text', 'smaller text', 'readability'],
                keywords_pl: ['rozmiar czcionki', 'rozmiar tekstu', 'większy tekst', 'mniejszy tekst', 'czytelność'],
                priority: 5,
                responses: {
                    pl: "Możesz dostosować rozmiar czcionki za pomocą przycisków <i class='fas fa-plus'></i> (powiększ), <i class='fas fa-minus'></i> (zmniejsz) i <i class='fas fa-text-height'></i> (resetuj) znajdujących się w prawym górnym rogu strony, obok selektora języka.",
                    en: "You can adjust the font size using the <i class='fas fa-plus'></i> (increase), <i class='fas fa-minus'></i> (decrease), and <i class='fas fa-text-height'></i> (reset) buttons located in the top right corner of the page, next to the language selector."
                }
            },
             'intent_print_help': {
                keywords_en: ['print', 'how print', 'paper copy', 'save pdf'],
                keywords_pl: ['drukuj', 'jak drukować', 'wersja papierowa', 'zapisać pdf'],
                priority: 6,
                responses: {
                    pl: "Aby wydrukować rozkład aktualnie wyświetlanego pociągu, znajdź przycisk '<i class=\"fas fa-print\"></i> Drukuj Rozkład' w nagłówku sekcji tego pociągu (pod jego nazwą) i kliknij go.",
                    en: "To print the timetable of the currently displayed train, find the '<i class=\"fas fa-print\"></i> Print Timetable' button in the header of that train's section (below its name) and click it."
                }
            },
             'intent_report_error': {
                keywords_en: ['report error', 'mistake', 'bug', 'wrong data', 'suggestion', 'feedback', 'contact author'],
                keywords_pl: ['zgłoś błąd', 'pomyłka', 'złe dane', 'sugestia', 'feedback', 'kontakt z autorem', 'uwaga'],
                priority: 8,
                responses: {
                    pl: "Jeśli znalazłeś błąd w rozkładzie, danych o pociągu lub działaniu strony, albo masz sugestię, użyj przycisku '<i class=\"fas fa-envelope\"></i> Zgłoś uwagę' na samym dole strony (w stopce). Otworzy to formularz zgłoszeniowy.",
                    en: "If you found an error in the timetable, train data, or site functionality, or if you have a suggestion, please use the '<i class=\"fas fa-envelope\"></i> Report an issue' button at the very bottom of the page (in the footer). This will open the reporting form."
                }
            },
            // --- Train Specific Info ---
            'intent_train_speed': {
                keywords_en: ['speed', 'how fast', 'maximum speed', 'velocity', 'km/h', 'kph'],
                keywords_pl: ['prędkość', 'jak szybko', 'maksymalna prędkość', 'km/h'],
                priority: 7,
                responses: {
                    pl: "Prędkość pociągu zależy od jego typu (np. Pendolino do 200 km/h, IC z lokomotywą Husarz do 160 km/h, IC z EP07 do 125 km/h) oraz od stanu infrastruktury na danym odcinku trasy. Orientacyjne prędkości dla konkretnego pociągu znajdziesz w sekcji '<i class=\"fas fa-tachometer-alt\"></i> Prędkość na odcinkach trasy'.",
                    en: "The train's speed depends on its type (e.g., Pendolino up to 200 km/h, IC with Husarz loco up to 160 km/h, IC with EP07 up to 125 km/h) and the infrastructure condition on a given route section. Approximate speeds for a specific train can be found in the '<i class=\"fas fa-tachometer-alt\"></i> Speed on route sections' section."
                }
            },
            'intent_train_wifi': {
                keywords_en: ['wifi', 'internet', 'wi-fi', 'connection', 'online'],
                keywords_pl: ['wifi', 'internet', 'wi-fi', 'połączenie', 'online'],
                priority: 6,
                responses: {
                    pl: "Dostępność WiFi (<i class='fas fa-wifi'></i>) zależy od typu pociągu i modernizacji wagonów. Zazwyczaj jest dostępne w Pendolino (EIP) i nowszych składach EIC/IC. W starszych składach IC/TLK może go nie być lub być dostępne tylko w niektórych wagonach. Sprawdź sekcję 'Informacje o składzie' dla wybranego pociągu, aby zobaczyć orientacyjną dostępność.",
                    en: "WiFi (<i class='fas fa-wifi'></i>) availability depends on the train type and coach modernization. It's usually available on Pendolino (EIP) and newer EIC/IC compositions. On older IC/TLK trains, it might be unavailable or only in specific coaches. Check the 'Composition Information' section for the selected train for indicative availability."
                }
            },
             'intent_train_sockets': {
                keywords_en: ['sockets', 'power outlets', 'plug', 'charge phone', 'electricity'],
                keywords_pl: ['gniazdka', 'gniazdko', 'prąd', 'ładować telefon', 'ładowanie', 'elektryczne'],
                priority: 6,
                responses: {
                    pl: "Gniazdka elektryczne (<i class='fas fa-plug'></i>) są standardem w pociągach EIP (Pendolino) oraz w większości nowszych lub zmodernizowanych wagonów EIC i IC. W starszych wagonach (szczególnie w pociągach TLK) ich dostępność może być ograniczona lub mogą znajdować się tylko na korytarzu. Sprawdź 'Informacje o składzie' dla szczegółów.",
                    en: "Power sockets (<i class='fas fa-plug'></i>) are standard on EIP (Pendolino) trains and in most newer or modernized EIC and IC coaches. In older coaches (especially on TLK trains), their availability might be limited or they might only be located in the corridor. Check 'Composition Information' for details."
                }
            },
             'intent_train_catering': {
                keywords_en: ['catering', 'food', 'drinks', 'wars', 'dining car', 'bistro', 'eat', 'restaurant'],
                keywords_pl: ['catering', 'jedzenie', 'picie', 'wars', 'wagon restauracyjny', 'barowy', 'bistro', 'jeść'],
                priority: 7,
                responses: {
                    pl: "Wagon restauracyjny lub barowy WARS (<i class='fas fa-utensils'></i>) jest zazwyczaj dostępny w pociągach kategorii EIP, EIC i wybranych IC. W niektórych pociągach IC/TLK może być oferowany catering mobilny (wózek). Sprawdź 'Informacje o składzie' dla konkretnego pociągu. Pamiętaj, że dostępność oferty WARS może się zmienić.",
                    en: "A WARS restaurant or dining car (<i class='fas fa-utensils'></i>) is usually available on EIP, EIC, and selected IC category trains. Mobile catering (trolley service) might be offered on some IC/TLK trains. Check 'Composition Information' for the specific train. Keep in mind that WARS service availability can change."
                }
            },
              'intent_train_ac': {
                keywords_en: ['air conditioning', 'ac', 'cooling', 'heating', 'temperature', 'climate control'],
                keywords_pl: ['klimatyzacja', 'klima', 'chłodzenie', 'ogrzewanie', 'temperatura', 'klimatronik'],
                priority: 6,
                responses: {
                    pl: "Klimatyzacja (<i class='fas fa-snowflake'></i>) jest standardem w pociągach EIP (Pendolino) oraz w większości nowszych lub zmodernizowanych wagonów EIC i IC. W starszych składach (np. niektóre wagony w IC/TLK) może jej nie być lub może być niesprawna. Sekcja 'Informacje o składzie' podaje orientacyjną dostępność dla danego pociągu.",
                    en: "Air conditioning (<i class='fas fa-snowflake'></i>) is standard on EIP (Pendolino) trains and in most newer or modernized EIC and IC coaches. In older compositions (e.g., some coaches in IC/TLK), it might be unavailable or malfunctioning. The 'Composition Information' section provides indicative availability for the given train."
                }
            },
            // --- Fallback ---
            'intent_fallback': {
                keywords_en: [], // No keywords, triggered when no other intent matches well
                keywords_pl: [],
                priority: 0,
                responses: {
                    pl: "Przepraszam, nie jestem pewien, jak odpowiedzieć na to pytanie. Czy możesz spróbować sformułować je inaczej? Mogę pomóc w kwestiach dotyczących nawigacji po tej stronie, jej funkcji lub ogólnych informacji o pociągach tu przedstawionych.",
                    en: "Sorry, I'm not sure how to answer that. Could you try phrasing your question differently? I can help with topics related to navigating this site, its features, or general information about the trains presented here."
                }
            }
        };

        // --- Chatbot Helper Functions ---
        function preprocessText(text, lang = 'en') {
            if (!text) return [];
            text = text.toLowerCase().replace(/[.,!?]/g, ''); // Lowercase and remove basic punctuation
            const words = text.split(/\s+/);
            const stopWords = lang === 'pl' ? stopWords_pl : stopWords_en;
            return words.filter(word => word.length > 1 && !stopWords.has(word)); // Filter short words and stop words
        }

        function findBestMatch_new(userInput) {
            const processedInput = preprocessText(userInput, currentLang);
            if (processedInput.length === 0) return 'intent_fallback'; // Handle empty input after processing

            let bestMatchIntent = 'intent_fallback';
            let highestScore = 0;
            const MIN_CONFIDENCE_THRESHOLD = 0.35; // Adjust this threshold (0 to 1)

            console.log(`Processed Input (${currentLang}):`, processedInput); // Debug log

            for (const intentKey in chatKB_new) {
                if (intentKey === 'intent_fallback') continue;

                const intent = chatKB_new[intentKey];
                const keywords_lang = currentLang === 'pl' ? 'keywords_pl' : 'keywords_en';
                const intentKeywords = intent[keywords_lang] || intent['keywords_en'] || []; // Fallback to English keywords

                 if (intentKeywords.length === 0) continue;

                 let currentScore = 0;
                 let matchedKeywordCount = 0;

                 // Flatten keywords for easier processing (treat phrases as single units for now)
                 const processedIntentKeywords = intentKeywords.map(kw => preprocessText(kw, currentLang).join(' ')).filter(kw => kw);

                 processedIntentKeywords.forEach(procKw => {
                     const kwWords = procKw.split(' ');
                     let keywordMatchScore = 0;
                     let wordsFound = 0;

                     kwWords.forEach(word => {
                         if (processedInput.includes(word)) {
                            wordsFound++;
                             // Give more weight if the word is longer (more specific)
                            keywordMatchScore += (1 + word.length * 0.1);
                         }
                     });

                     // Calculate score based on how many words of the keyword phrase matched
                     if (wordsFound > 0) {
                         // Higher score if more words of the phrase match, max if all match
                         const matchRatio = wordsFound / kwWords.length;
                         currentScore += keywordMatchScore * (matchRatio === 1 ? 2.0 : matchRatio * 1.5); // Bonus for full phrase match
                         matchedKeywordCount++;
                     }
                 });

                 // Normalize score by the number of keywords for the intent to avoid bias towards intents with many keywords
                 // Add a bonus for matching multiple distinct keywords from the intent's list
                 const finalScore = (currentScore / (processedIntentKeywords.length || 1)) + (matchedKeywordCount > 1 ? matchedKeywordCount * 0.5 : 0); // Bonus for matching >1 keyword


                console.log(`Intent: ${intentKey}, Score: ${finalScore.toFixed(2)}, Matched Keywords: ${matchedKeywordCount}`); // Debug log

                // Compare with highest score found so far
                // Use priority to break ties or boost specific intents
                const priorityBoost = (intent.priority || 1);
                const scoreWithPriority = finalScore * priorityBoost;

                if (scoreWithPriority > highestScore) {
                    highestScore = scoreWithPriority;
                    bestMatchIntent = intentKey;
                }
            }

            // Apply confidence threshold - if highest score is too low, revert to fallback
            // Calculate a relative confidence based on potential max score (this is tricky, simplified here)
            // Let's use a simpler absolute threshold for now, adjusted by priority impact
             const effectiveThreshold = MIN_CONFIDENCE_THRESHOLD * (chatKB_new[bestMatchIntent]?.priority || 1); // Scale threshold by priority

             console.log(`Best Match: ${bestMatchIntent}, Highest Score (w/ prio): ${highestScore.toFixed(2)}, Threshold: ${effectiveThreshold.toFixed(2)}`);

            if (highestScore < effectiveThreshold && bestMatchIntent !== 'intent_fallback') {
                 console.log("Score below threshold, reverting to fallback.");
                 return 'intent_fallback';
            }


            return bestMatchIntent;
        }

        // --- Chatbot Core Functions (UI + Logic) ---

        function toggleChat() {
            isChatOpen = !isChatOpen;
            chatWidget.classList.toggle('active', isChatOpen);
             chatToggleButton.querySelector('i').classList.toggle('fa-comments', !isChatOpen);
             chatToggleButton.querySelector('i').classList.toggle('fa-times', isChatOpen); // Change icon when open

            // Moved greeting logic to initializeChatbot listener to ensure it uses the NEW function
            if (isChatOpen) {
                 chatInput.focus(); // Focus input when opening
             }
        }

         function addChatMessage(message, sender) {
             // Remove typing indicator before adding new message
            const typingIndicator = chatMessagesContainer.querySelector('.typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }

            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', sender);
            // Use innerHTML to allow basic HTML like links in responses
            messageElement.innerHTML = message;
            chatMessagesContainer.appendChild(messageElement);

            // Scroll to the bottom
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
         }

         function showTypingIndicator() {
              const typingElement = document.createElement('div');
              typingElement.classList.add('chat-message', 'bot', 'typing-indicator');
              typingElement.innerHTML = `
                  <span class="typing-dot"></span>
                  <span class="typing-dot"></span>
                  <span class="typing-dot"></span>
              `;
              chatMessagesContainer.appendChild(typingElement);
              chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
         }

         // Modify getChatbotResponse to use the new KB structure
         function getChatbotResponse_new(intentKey) {
             const intent = chatKB_new[intentKey];
             const fallbackIntent = chatKB_new['intent_fallback'];

             if (!intent || !intent.responses) {
                  console.warn(`Intent or responses not found for key: ${intentKey}. Using fallback.`);
                  // Ensure fallbackIntent and its responses exist
                  if (fallbackIntent && fallbackIntent.responses) {
                      return fallbackIntent.responses[currentLang] || fallbackIntent.responses['en'] || "Sorry, I cannot process this request."; // Final fallback text
                  } else {
                      return "Sorry, I cannot process this request."; // Final fallback if even fallback is broken
                  }
             }

             // Ensure intent.responses and the specific language response exist
             const response = intent.responses[currentLang] || intent.responses['en'];
             if (response) {
                 return response;
             } else {
                  console.warn(`Response text not found for intent ${intentKey} in lang ${currentLang} or fallback 'en'.`);
                  // Use fallback response if specific language response is missing
                  if (fallbackIntent && fallbackIntent.responses) {
                      return fallbackIntent.responses[currentLang] || fallbackIntent.responses['en'] || "Sorry, I cannot process this request.";
                  } else {
                      return "Sorry, I cannot process this request.";
                  }
             }
         }


         // Modify handleChatSend to use the new functions
         function handleChatSend() {
             const userInput = chatInput.value.trim();
             if (!userInput) return;

             addChatMessage(userInput, 'user');
             chatInput.value = ''; // Clear input field

             // Simulate bot thinking and show typing indicator
             clearTimeout(chatBotTypingTimeout);
             showTypingIndicator();

             chatBotTypingTimeout = setTimeout(() => {
                 const matchedIntentKey = findBestMatch_new(userInput); // Use the new matching function
                 const botResponse = getChatbotResponse_new(matchedIntentKey); // Use the new response function
                 addChatMessage(botResponse, 'bot');
             }, 800 + Math.random() * 500); // Delay response slightly
         }

         // --- Chatbot Initialization ---
         function initializeChatbot() {
             chatToggleButton.addEventListener('click', toggleChat);
             chatCloseButton.addEventListener('click', toggleChat);
             chatSendButton.addEventListener('click', handleChatSend); // Uses the updated handleChatSend
             chatInput.addEventListener('keypress', (event) => {
                 if (event.key === 'Enter') {
                     event.preventDefault();
                     handleChatSend(); // Uses the updated handleChatSend
                 }
             });

             // Add initial greeting when chat opens (if empty) - uses NEW response getter
            chatToggleButton.addEventListener('click', () => {
                 // Add slight delay to ensure toggleChat finishes class changes etc.
                 setTimeout(() => {
                     if (isChatOpen && chatMessagesContainer.children.length === 0) {
                         addChatMessage(getChatbotResponse_new("intent_greeting"), 'bot');
                     }
                 }, 50);
            });
         }

        // ============================================== //
        // === END: NEW IMPROVED CHATBOT CODE =========== //
        // ============================================== //


        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeLanguage(); // Must run before chatbot init if chatbot uses language state
            initializeTheme();
            initializeFontSize();
            initializeTrainSwitcher();
            initializeSearch();
            initializePrint();
            initializeModal();
            initializeChatbot(); // Initialize the NEW chatbot
            updateDateTime();
            setInterval(updateDateTime, 1000);
        });

    </script>

</body>
</html>